from django.db import models
from datetime import datetime

# Create your models here.

  

class Empleado(models.Model):
    cedula = models.CharField("Cédula", max_length=11, primary_key=True)
    usuario = models.CharField("Nombre de Usuario", max_length=150)
    nombre = models.CharField("Nombre", max_length=255)
    apellido = models.CharField("Apellido", max_length=255)
    departamento = models.ForeignKey("AdministracionSistema.Departamento", verbose_name="Departamento", on_delete=models.CASCADE)
    division = models.ForeignKey("AdministracionSistema.Division", verbose_name="División", on_delete=models.CASCADE)
    cargo = models.CharField("Cargo", max_length=255)
    grupo_ocupacional = models.CharField("Grupo ocupacional", max_length=1)
    fecha_nacimiento = models.DateField("Fecha Nacimiento", auto_now=False, auto_now_add=False)
    fecha_ingreso = models.DateField("Fecha de ingreso", auto_now=False, auto_now_add=True)
    sueldo = models.FloatField("Sueldo")

    @property
    def edad(self):
        dias_de_nacido = datetime.now().date() - self.fecha_nacimiento
        edad = int(dias_de_nacido.days / 365)
        return edad

    def __str__(self) -> str:
        return f"{self.nombre} {self.apellido}"

class Permiso(models.Model):
    empleado = models.ForeignKey(Empleado, verbose_name="Empleado", on_delete=models.CASCADE)
    fecha_solicitud = models.DateField("Fecha de solicitud", auto_now=True)
    fecha_permiso = models.DateField("Fecha del permiso", auto_now=False, auto_now_add=False)
    desde_hora = models.TimeField("Desde", auto_now=False, auto_now_add=False)
    hasta_hora = models.TimeField("Hasta", auto_now=False, auto_now_add=False)
    tiempo = models.FloatField("Tiempo")
    justificacion = models.TextField("Justificación")
    estado = models.CharField("Estado de aprobación", max_length=50, choices=[('PENDIENTE', 'PENDIENTE'), ('APROBADO', 'APROBADO'), ('DENEGADO', 'DENEGADO')])
    comentario = models.TextField("Comentario", null=True, blank=True)

    def __str__(self) -> str:
        return f"{self.fecha_permiso} | {self.empleado.nombre} {self.empleado.apellido} - {self.empleado.cedula}"