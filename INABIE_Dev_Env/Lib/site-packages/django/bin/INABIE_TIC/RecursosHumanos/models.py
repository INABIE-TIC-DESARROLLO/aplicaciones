from django.db import models
from datetime import datetime

# Create your models here.

  

class Empleado(models.Model):
    cedula = models.CharField("Cédula", max_length=11, primary_key=True)
    usuario = models.CharField("Nombre de Usuario", max_length=150, null=True, blank=True)
    nombre = models.CharField("Nombre", max_length=255)
    apellido = models.CharField("Apellido", max_length=255, null=True, blank=True)
    direccion = models.ForeignKey("AdministracionSistema.Direccion", verbose_name="Direccion", on_delete=models.CASCADE, null=True, blank=True)
    departamento = models.ForeignKey("AdministracionSistema.Departamento", verbose_name="Departamento", on_delete=models.CASCADE, null=True, blank=True)
    division = models.ForeignKey("AdministracionSistema.Division", verbose_name="División", on_delete=models.CASCADE, null=True, blank=True)
    cargo = models.CharField("Cargo", max_length=255, null=True, blank=True)
    grupo_ocupacional = models.CharField("Grupo ocupacional", max_length=1, null=True, blank=True)
    fecha_nacimiento = models.DateField("Fecha Nacimiento", auto_now=False, auto_now_add=False, null=True, blank=True)
    fecha_ingreso = models.DateField("Fecha de ingreso", auto_now=False, null=True, blank=True)
    tipo_nomina = models.CharField("Tipo Nomina", max_length=30, null=True, blank=True)
    sueldo = models.FloatField("Sueldo", null=True, blank=True)

    # @property
    # def edad(self):
    #     dias_de_nacido = datetime.now().date() - self.fecha_nacimiento
    #     edad = int(dias_de_nacido.days / 365)
    #     return edad

    def __str__(self) -> str:
        return self.nombre

class Permiso(models.Model):
    empleado = models.ForeignKey(Empleado, verbose_name="Empleado", on_delete=models.CASCADE)
    fecha_solicitud = models.DateField("Fecha de solicitud", auto_now=True)
    fecha_permiso = models.DateField("Fecha del permiso", auto_now=False, auto_now_add=False)
    desde_hora = models.TimeField("Desde", auto_now=False, auto_now_add=False)
    hasta_hora = models.TimeField("Hasta", auto_now=False, auto_now_add=False)
    tiempo = models.FloatField("Tiempo")
    justificacion = models.TextField("Justificación")
    estado = models.CharField("Estado de aprobación", max_length=50, choices=[('PENDIENTE', 'PENDIENTE'), ('APROBADO', 'APROBADO'), ('DENEGADO', 'DENEGADO')])
    comentario = models.TextField("Comentario", null=True, blank=True)
    archivo_evidencia = models.FileField("Archivo de evidencia", upload_to="C:/media", max_length=2000, null=True, blank=True)

    def __str__(self) -> str:
        return f"{self.fecha_permiso} | {self.empleado.nombre} {self.empleado.apellido} - {self.empleado.cedula}"