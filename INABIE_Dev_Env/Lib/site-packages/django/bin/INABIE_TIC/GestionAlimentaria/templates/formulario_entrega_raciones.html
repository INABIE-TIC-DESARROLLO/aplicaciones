<!DOCTYPE html>
<html lang="es">
    <head>
        {% load static %}
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>INABIE - Formulario Entrega raciones</title>
        <link rel="icon" href="https://inabie.gob.do/images/imagenes/logo.jpg">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    
        <style>

            html{
                height: 100vh;
            }
            body{
                background-image: linear-gradient(rgba(255, 0, 0, 0.306), #003a70f6), url("{% static '/imagenes/pae_entrega.png'%}");
                background-position: center;
                background-size: auto;
                height: 100vh;
            }
            h1, h2, h3, h4, h5, h6{
                color: #003970;
            }
            .h2-color{
                color: white;
            }
            .tamaño-titulo{
                /* background-color: rgb(34, 39, 195); */
                font-size: 27px;
            }
            .btn-color-inabie{
                font-weight: bold;
                background-color: #003970;
                color: white;
            }
            .btn-color-inabie:hover{
                background-color: #00294d;
                color: white;
            }

            #header-body{
                opacity: .85;
                position: fixed;
                width: 100%;
                top: 3%;

            }

            @keyframes animar-icono {
                from{
                    transform: scale(1);
                }

                to{
                    transform: scale(1.8);
                }
            }

            @keyframes hacer-visible {
                from{
                    opacity: .2;
                }

                to{
                    opacity: 1;
                }
            }

            #principal-container{
                position: relative;
                top: 3%;
                opacity: 1;
                animation: hacer-visible 3s;

            }

            #icono-mensaje{
                width: 3%;
                margin: 0 .5rem;
                transform: scale(1);
                animation: animar-icono 1s alternate infinite;

            }

            #contenedor-formulario{
                width: 90%;
                margin: 0 auto;
            }
        </style>

    </head>
    <body>
        <div id="principal-container">
            <section>
                <nav class="navbar navbar-expand-md mb-0 navbar-light bg-light w-100">
                    <div class="container-fluid ">
            
                        <a class="navbar-brand" href="#" >
                            <!-- Img resposive  -->
                            <img class=" d-none d-sm-block" src="{% static '/imagenes/logo-inabie-izquierda.png'%}" height="100" style="margin-left: 60px;">
                            <img  class="d-block d-sm-none" src="{% static '/imagenes/LOGO-MOSCA-02.png'%}" height="80" style="margin-left: 60px;">
                        </a>
                        <!-- Tema -->
                        <div class="tema text-center d-none d-lg-block" style="width: 55%;">
                            
                            <h2 class="fw-bold font-color">INABIE - PAE - SISTEMA RECEPCIÓN  DE ALIMENTOS</h2>
                        </div>
    
                        <!-- Button hamburguesa para pantallas pequeñas -->
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse align-items-end justify-content-end" id="navbarSupportedContent" style="margin-right: 50px; width: 500px;">
                            <ul class="navbar-nav text-right">
                                <li class="nav-item">
                                    <a class="nav-link active" aria-current="page" href="#">Bienvenido/a, <strong>{{user}}</strong></a>
                                </li>
                                <li class="nav-item">
                                    <a class="text-primary nav-link active" href="/gestion-alimentaria/logout" role="button">Cerrar Sesión</a>
                                </li>
                            </ul>
                        </div>
            
                    </div>
                </nav>
            </section>
    
            <div id="contenedor-formulario">
                <div class="row">
                    <div class="col">
                        <div class="col mt-4 p-4 rounded bg-white shadow">
    
                            <!-- FORMULARIO -->
                            <form class="row g-3" id="entrega-raciones-form" method="post">
                                {% csrf_token %}
                                <!-- ---------------------------------------- -->
                                <!--** SECCION DATOS DEL CECNTRO EDUCATIVO **-->
                                <!-- ---------------------------------------- -->
                                
                                <h3 class="mt-0 fw-bold">Datos del Centro Educativo</h3>
                                <div class="col-md-1 was-validated w-sm-25 mt-0">
                                    <label for="codigo_ce" class="form-label fw-bold">Código</label>
                                    <input type="text" class="form-control" name="codigo_ce" id="codigo_ce" value="{{datos_entrega_consultada.codigo_ce}}" required readonly>
                                </div>
    
                                <div class="col-md-2 was-validated mt-0">
                                    <label for="nombre_ce" class="form-label fw-bold">Nombre</label>
                                    <input type="text" class="form-control" name="nombre_ce" id="nombre_ce" value="{{datos_entrega_consultada.nombre_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="provincia_ce" class="form-label fw-bold">Provincia</label>
                                    <input type="text" class="form-control" name="provincia_ce" id="provincia_ce" value="{{datos_entrega_consultada.provincia_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="municipio_ce" class="form-label fw-bold">Municipio</label>
                                    <input type="text" class="form-control" name="municipio_ce" id="municipio_ce" value="{{datos_entrega_consultada.municipio_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="regional_ce" class="form-label fw-bold">Regional</label>
                                    <input type="text" class="form-control" name="regional_ce" id="regional_ce" value="{{datos_entrega_consultada.regional_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="distrito_ce" class="form-label fw-bold">Distrito</label>
                                    <input type="text" class="form-control" name="distrito_ce" id="distrito_ce" value="{{datos_entrega_consultada.distrito_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="sector_ce" class="form-label fw-bold">Sector</label>
                                    <input type="text" class="form-control" name="sector_ce" id="sector_ce" value="{{datos_entrega_consultada.sector_ce}}" autocomplete="off" required  readonly>
                                </div>


                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="direccion_ce" class="form-label fw-bold">Dirección</label>
                                    <input type="text" class="form-control" name="direccion_ce" id="direccion_ce" value="{{datos_entrega_consultada.direccion_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="telefono_ce" class="form-label fw-bold">Teléfono</label>
                                    <input type="text" class="form-control" name="telefono_ce" id="telefono_ce" value="{{datos_entrega_consultada.telefono_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="modalidad_ce" class="form-label fw-bold">Modalidad</label>
                                    <input type="text" class="form-control" name="modalidad_ce" id="modalidad_ce" value="{{datos_entrega_consultada.modalidad_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0 d-none">
                                    <label for="tanda_ce" class="form-label fw-bold">Tanda</label>
                                    <input type="text" class="form-control" name="tanda_ce" id="tanda_ce" value="{{datos_entrega_consultada.tanda_ce}}" autocomplete="off" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0">
                                    <label for="director_ce" class="form-label fw-bold">Nombre Director</label>
                                    <input type="text" class="form-control mb-2" name="director_ce" id="director_ce" value="{{datos_entrega_consultada.director_ce}}" required  readonly>
                                </div>

                                <div class="col-md-2 was-validated mt-0">
                                    <label for="director_telefono_ce" class="form-label fw-bold">Teléfono del Director</label>
                                    <input type="text" class="form-control mb-2" name="director_telefono_ce" id="director_telefono_ce" value="{{datos_entrega_consultada.director_telefono_ce}}" required  readonly>
                                </div>
    
                                <!-- datos de la entrega de raciones -->
                                <h3 class="mt-0 fw-bold">Datos de la Recepción de Alimentos</h3>
                                <h5 class="fw-bold mt-0">Datos de la entrega</h5>

                                <!-- datos del proveedor -->
                                <div class="col-md-4 was-validated d-none">
                                    <label for="cedula_rnc_cont" class="form-label">Cédula Proveedor</label>
                                    <input type="text" class="form-control" name="cedula_rnc_cont" id="cedula_rnc_cont" value="{{datos_entrega_consultada.cedula_rnc_cont}}" required  readonly>
                                </div>
    
                                <div class="col-md-2 was-validated">
                                    <label for="nombre_prov" class="form-label fw-bold">Proveedor</label>
                                    <input type="text" class="form-control" name="nombre_prov" id="nombre_prov" value="{{datos_entrega.0.nombre_prov}}" placeholder="" autocomplete="off" required readonly>
                                </div>

                                <div class="col-md-2 was-validated d-none">
                                    <label for="email_prov" class="form-label fw-bold">Email Proveedor</label>
                                    <input type="text" class="form-control" name="email_prov" id="email_prov" value="{{datos_entrega.0.email_prov}}" placeholder="" autocomplete="off" required readonly>
                                </div>

                                <div class="col-md-2 was-validated d-none">
                                    <label for="telefono_prov" class="form-label fw-bold">Télefono Proveedor</label>
                                    <input type="text" class="form-control" name="telefono_prov" id="telefono_prov" value="{{datos_entrega.0.telefono_prov}}" placeholder="" autocomplete="off" required readonly>
                                </div>
    
                                <!-- datos de la entrega de raciones -->
                                <div class="col-md-2 was-validated">
                                    <label for="tipo_producto" class="form-label fw-bold">Alimentos</label>
                                    <select name="tipo_producto" id="tipo_producto" class="form-select" required>
    
                                        {% for alimento in datos_entrega%}
                                            <option value="{{alimento.producto_alimento_lth}}">{{alimento.producto_alimento_lth}}</option>
                                        {% endfor %}
                                        
                                        
                                    </select>
                                </div>
    
                                <div class="col-md-2 was-validated">
                                    <label for="raciones_a_recibir" class="form-label fw-bold">Raciones a recibir</label>
                                    <input type="text" class="form-control" name="raciones_a_recibir" value="{{datos_entrega.0.lote_raciones_diarias_total_ltd}}" id="raciones_a_recibir" placeholder="" autocomplete="off" required readonly>
                                </div>
    
                                <div class="col-md-2 was-validated">
                                    <label for="raciones_recibidas" class="form-label fw-bold">Raciones recibidas</label>
                                    <input type="number" class="form-control"  name="raciones_recibidas" id="raciones_recibidas" placeholder="raciones recibidas" autocomplete="off" required required min="1" max="{{datos_entrega_consultada.matricula_tanda_ce}}" >
                                </div>
    
                                <div class="col-md-4 was-validated mb-4">
                                    <label for="entrega_segun_menu" class="form-label fw-bold">¿Recibió los alimentos especificados en el menú?</label>
                                    <select name="entrega_segun_menu" id="entrega_segun_menu" class="form-select" style="width: 40%;" required >
                                        <option value="1">Sí</option>
                                        <option value="0">No</option>
                                    </select>
                                </div>

                                <!-- <div class="col-md-4 was-validated">
                                    <label for="foto_alimentos" class="form-label fw-bold">Cargar foto de los alimentos</label>
                                    <input type="file" class="form-control" name="foto_alimentos" id="foto_alimentos">
                                </div>
                                
                                <div class="col-md-4 was-validated">
                                    <label for="fotos_transporte" class="form-label fw-bold">Cargar foto del transporte</label>
                                    <input type="file" class="form-control" name="foto_transporte" id="foto_transporte">
                                </div> -->
    
                                
                                <h5 class="fw-bold">Datos de la calidad de la entrega</h5>
    
                                <div class="col-md-2 was-validated">
                                    <label for="condicion_raciones" class="form-label fw-bold">Condiciones</label>
                                    <select name="condicion_raciones" id="condicion_raciones" class="form-select" required >
                                        <option value="buena">Buena</option>
                                        <option value="regular">Regular</option>
                                        <option value="mala">Mala</option>
                                    </select>
                                </div>
    
                                <div class="col-md-2 was-validated">
                                    <label for="hubo_incidencia" class="form-label fw-bold" style="font-size: 0.97em;">¿Hubo alguna incidencia?</label>
                                    <select name="hubo_incidencia" id="hubo_incidencia" class="form-select" required >
                                        <option value="1">Sí</option>
                                        <option value="0" selected>No</option>
                                    </select>
                                </div>
    

                                <div class="col-md-2 was-validated justify-content-center" id="tipo_incidencia" style="display: none;">
                                    <label for="tipo_incidencia" class="form-label fw-bold">Tipo de incidencia</label>
                                    <select name="tipo_incidencia" id="tipo_incidencia" class="form-select" required >
                                        
                                        <option value="Incidencia de entrega">Incidencia de entrega</option>
                                        <option value="Incidencia de calidad">Incidencia de calidad</option>
                                        <option value="Incidencia de nutrición">Incidencia de nutrición</option>
                                    </select>
                                </div>
    
                                <!-- Fotos de alimentos y transporte -->
                                
                                <hr class="mb-0">
    
                                <div class="col-md-12 was-validated">
                                    <label for="comentario" class="form-label fw-bold">Comentarios generales:</label>
                                    <textarea name="comentario" id="comentario" cols="10" rows="2" class="form-control" maxlength="300"></textarea>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn fw-bold btn-color-inabie">Enviar</button>
                                </div>
                            </form>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        

        <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>

        {{datos_entrega|json_script:"datos-entrega"}}

        <script>
            
            const datos_entrega = JSON.parse(document.getElementById('datos-entrega').textContent);

            const nombre_proveedor = document.getElementById('nombre_prov')
            const cedula_rnc_proveedor = document.getElementById('cedula_rnc_cont')
            const email_proveedor = document.getElementById('email_prov')
            const telefono_proveedor = document.getElementById('telefono_prov')
            const raciones_a_recibir = document.getElementById('raciones_a_recibir')
            const raciones_recibidas = document.getElementById('raciones_recibidas')
            const tipo_producto = document.getElementById('tipo_producto')

            const entregaRacionesForm = document.getElementById('entrega-raciones-form')
            const recibioSegunMenuInput = document.getElementById('entrega_segun_menu')
            const comentario = document.getElementById('comentario')

            const periodo_escolar = document.getElementById('periodo_escolar')
            const distrito_ce = document.getElementById('periodo_escolar')
            const regional_ce = document.getElementById('periodo_escolar')

            const condicion_alimentos = document.getElementById("condicion_raciones");
            const incidencia = document.getElementById("hubo_incidencia");
            const tipo_incidencia = document.getElementById("tipo_incidencia");

            //elegir producto alimento
            if(tipo_producto) 
            tipo_producto.addEventListener("input", e => {
                
                for(let registro of datos_entrega){

                    if (registro.producto_alimento_lth == e.target.value) {
                        nombre_proveedor.value = registro.nombre_prov
                        cedula_rnc_proveedor.value = registro.cedula_rnc_cont
                        email_proveedor.value = registro.email_prov
                        telefono_proveedor.value = registro.telefono_prov
                        raciones_a_recibir.value = registro.lote_raciones_diarias_total_ltd
                        raciones_recibidas.setAttribute('max', registro.lote_raciones_diarias_total_ltd)
                    }
                }
            });

            if(recibioSegunMenuInput)
            recibioSegunMenuInput.addEventListener("input", e => {
                if(recibioSegunMenuInput.value == "1" && condicion_alimentos.value == "buena" && incidencia.value == '0'){
                    comentario.removeAttribute("required")
                    comentario.removeAttribute("minlength")
                } else {
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                }
            });

            if(incidencia)
            incidencia.addEventListener("input", () => {
                if (incidencia.value == '1'){
                    tipo_incidencia.style.display = 'block';
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)

                } else if(recibioSegunMenuInput.value == "0" || condicion_alimentos.value != 'buena'){
                    tipo_incidencia.style.display = 'none';
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                } else {
                    tipo_incidencia.style.display = 'none';
                    comentario.removeAttribute("required")
                    comentario.removeAttribute("minlength")
                }

            });
                
            if(condicion_alimentos)
            condicion_alimentos.addEventListener("input", () => {
                if (condicion_alimentos.value === 'mala'){
                    incidencia.value = '1';
                    tipo_incidencia.style.display = 'block';
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                    
                } else if(condicion_alimentos.value == 'mala' || condicion_alimentos.value == 'regular') {
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                } else if (recibioSegunMenuInput.value == "0" || incidencia.value == '1'){
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                    
                } else {
                    comentario.removeAttribute("required")
                    comentario.removeAttribute("minlength")
                }

            });
                
            setTimeout(() => { //cerrar toast que tiene mensaje de retroalimentacion despues de hacer un request POST
                $('.toast').hide(1000)
            }, 10000);


            //para evitar que el formulario se vuelva a reenviar

            if ( window.history.replaceState ) {
                window.history.replaceState( null, null, window.location.href );
            }

        </script>





        </script>
    </body>
</html>
