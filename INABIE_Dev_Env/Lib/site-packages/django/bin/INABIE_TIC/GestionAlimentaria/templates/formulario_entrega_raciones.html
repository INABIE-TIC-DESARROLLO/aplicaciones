<!DOCTYPE html>
<html lang="es">
    <head>
        {% load static %}
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>INABIE - Formulario Entrega raciones</title>
        <link rel="icon" href="{%  static '/imagenes/logo.jpg' %}">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    
        <style>
            body{
                background-image: linear-gradient( 90deg,rgba(255, 0, 0, 0.306), rgb(0, 57, 112,0.75)), url("{% static 'imagenes/pae_entrega.png' %}");
                backdrop-filter: blur(1px);
                height: 100vh;
            }
            h1, h2, h3{
                color: #003970;
            }
            h5{
                color: rgb(70, 70, 70);
            }
            .h2-color{
                color: white;
            }
            .tamaño-titulo{
                /* background-color: rgb(34, 39, 195); */
                font-size: 27px;
            }
            .btn-color-inabie{
                background-color: #003970;
                color: white;
            }

            .btn-color-inabie:hover{
                background-color: #012e55;
                color: white;
            }
            @media screen and (max-width: 1200px) and (min-width:992px){ 
                .proveedor {
                    margin-top: 25px;
                }
            }
            @media screen and (max-width: 1400px) and (min-width:1200px){ 
                .tamaño-letra {
                    font-size: 12px;
                }
            }
            .bg-transparente{
                background-color: #ffffffc9;
            }
            .ancho-raciones-recibidas{
                width: 190px;
            }
            .ancho-calidad-entrega{
                max-width: 250px;
            }

        </style>

    </head>
    <body>
        <section>
            <nav class="navbar navbar-expand-md mb-0 navbar-light bg-transparente w-100" style="position: fixed; top: 3%;">
                <div class="container-fluid ">
        
                    <a class="navbar-brand" href="#" >
                        <!-- Img resposive  -->
                        <img class=" d-none d-sm-block" src="{% static '/imagenes/logo-inabie-izquierda.png' %}" height="100" style="margin-left: 60px;">
                        <img  class="d-block d-sm-none" src="{% static '/imagenes/LOGO-MOSCA-02.png' %}" height="80" style="margin-left: 60px;">
                    </a>
                    <!-- Tema -->
                    <div class="tema text-center d-none d-xl-block" style="width: 55%;">
                        
                        <h2 class="fw-bold font-color">INABIE - PAE - SISTEMA RECEPCIÓN  DE ALIMENTOS</h2>
                    </div>

                    <!-- Button hamburguesa para pantallas pequeñas -->
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse align-items-end justify-content-end" id="navbarSupportedContent" style="margin-right: 50px; width: 500px;">
                        <ul class="navbar-nav text-right">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">BIENVENIDO/A,</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" href="#"role="button">CERRAR SESION</a>
                            </li>
                        </ul>
                    </div>
        
                </div>
            </nav>
        </section>

        <div class="container">
            <div class="row">
                <div class="col" style="margin-top: 135px;">
                    <div class="col mt-5 mb-5 p-4 rounded bg-white shadow">

                        <!-- FORMULARIO -->
                        <form class="row g-3" id="entrega-raciones-form" method="post">
                            {% csrf_token %}
                            <!-- ---------------------------------------- -->
                            <!--** SECCION DATOS DEL CECNTRO EDUCATIVO **-->
                            <!-- ---------------------------------------- -->
                            
                            <h3 class="mt-0 fw-bold">Datos del Centro Educativo</h3>
                            <div class="col-md-2 was-validated w-25 mt-0">
                                <label for="codigo_ce" class="form-label fw-bold">Código</label>
                                <input type="text" class="form-control" name="codigo_ce" id="codigo_ce" value="{{datos_entrega_consultada.codigo_ce}}" required readonly>
                            </div>

                            <div class="col-lg-4 was-validated mt-0 align-items-end">
                                <label for="nombre_ce" class="form-label fw-bold">Nombre</label>
                                <input type="text" class="form-control" name="nombre_ce" id="nombre_ce" value="{{datos_entrega_consultada.nombre_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-lg-4 was-validated mt-0">
                                <label for="nombre_director" class="form-label fw-bold">Nombre Director</label>
                                <input type="text" class="form-control mb-2" name="nombre_director" id="nombre_director" value="" required  readonly>
                            </div>

                            <!-- datos de la entrega de raciones -->
                            <h3 class="mt-0 fw-bold">Datos de la Recepción de Alimentos</h3>
                            <h5 class="fw-bold mt-0">Datos de la entrega</h5>
                        <div class="row d-flex w-wrap">
                            <div class="col-sm-4 was-validated d-none">
                                <label for="cedula_proveedor" class="form-label">Cedula Proveedor</label>
                                <input type="text" class="form-control" name="cedula_proveedor" id="cedula_proveedor" value="{{datos_entrega_consultada.cedula_oferente}}" required  readonly>
                            </div>

                            <!-- datos del proveedor -->
                            <div class="col-lg-4 was-validated " style="max-width: 312px;">
                                <label for="nombre_proveedor" class="form-label fw-bold ">Proveedor</label>
                                <input type="text" class="form-control mb-3" name="nombre_proveedor" id="nombre_proveedor" value="{{datos_entrega_consultada.nombre_oferente}}" required  readonly>
                            </div>

                            <div class="col-lg-2 was-validated ancho-raciones-recibidas">
                                <label for="raciones_a_recibir" class="form-label fw-bold">Raciones a recibir</label>
                                <input type="text" class="form-control mb-3" name="raciones_a_recibir" id="raciones_a_recibir" value="{{datos_entrega_consultada.matricula_tanda_ce}}" autocomplete="off" required readonly>
                            </div>
                            <div class="col-lg-2 was-validated ancho-raciones-recibidas">
                                <label for="raciones_recibidas" class="form-label fw-bold">Raciones recibidas</label>
                                <input type="number" class="form-control mb-3"  name="raciones_recibidas" id="raciones_recibidas" placeholder="raciones recibidas" autocomplete="off" required required min="1" max="{{datos_entrega_consultada.matricula_tanda_ce}}" >
                            </div>

                            <div class="col-lg-5 was-validated mb-4">
                                <label for="entrega_segun_menu" class="form-label fw-bold">¿Recibió los alimentos especificados en el menú?</label>
                                <select name="entrega_segun_menu" id="entrega_segun_menu" class="form-select mb-2 w-50" required style="max-width: 150px;">
                                    <option></option>
                                    <option value="1">Sí</option>
                                    <option value="0">No</option>
                                </select>
                            </div>
                        </div>
                            <hr class="mt-0 mb-0">
                            <h5 class="fw-bold">Datos de la calidad de la entrega</h5>

                            <div class="col-xl-4 was-validated ancho-calidad-entrega">
                                <label for="condicion_raciones" class="form-label fw-bold">Condiciones</label>
                                <select name="condicion_raciones" id="condicion_raciones" class="form-select mb-2" required >
                                    <option></option>
                                    <option value="buena">Buena</option>
                                    <option value="regular">Regular</option>
                                    <option value="mala">Mala</option>
                                </select>
                            </div>

                            <div class="col-xl-2 was-validated" style="max-width: 250px;">
                                <label for="hubo_incidencia" class="form-label fw-bold tamaño-letra">¿Hubo alguna incidencia?</label>
                                <select name="hubo_incidencia" id="hubo_incidencia" class="form-select mb-2" required >
                                    <option></option>
                                    <option value="1">Sí</option>
                                    <option value="0">No</option>
                                </select>
                            </div>

                            <div class="col-xl-2 was-validated" id="tipo_incidencia"  style="display: none; max-width: 250px;">
                                <label for="tipo_incidencia" class="form-label fw-bold ">Tipo de incidencia</label>
                                <select name="tipo_incidencia" id="tipo_incidencia" class="form-select mb-2" required >
                                    <option></option>
                                    <option value="entrega">Incidencia de entrega</option>
                                    <option value="calidad">Incidencia de calidad</option>
                                    <option value="nutricion">Incidencia de nutrición</option>
                                </select>
                            </div>

                            <!-- Fotos de alimentos y transporte -->
                            <div class="col-xl-3 was-validated">
                                <label for="foto_alimentos" class="form-label fw-bold">Cargar foto de los alimentos</label>
                                <input type="file" class="form-control mb-2" name="foto_alimentos" id="foto_alimentos">
                            </div>
                            
                            <div class="col-xl-3 was-validated">
                                <label for="fotos_transporte" class="form-label fw-bold" style="width: 250px;">Cargar foto del transporte</label>
                                <input type="file" class="form-control mb-2" name="foto_transporte" id="foto_transporte">
                            </div>
                            <hr class="mb-0">

                            <div class="col-sm-12 was-validated">
                                <label for="comentario" class="form-label fw-bold">Comentarios generales:</label>
                                <textarea name="comentario" id="comentario" cols="10" rows="2" class="form-control mb-2" maxlength="300"></textarea>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn fw-bold btn-color-inabie">Enviar</button>
                            </div>
                        </form>
                        
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>

        <!--  {{datos_entrega|json_script:"datos-entrega"}}-->

        <script>
            // Formulario if // 

            const condicion_alimentos = document.getElementById("condicion_raciones");
            const incidencia = document.getElementById("hubo_incidencia");
            const tipo_incidencia = document.getElementById("tipo_incidencia");

            incidencia.onchange = function(){
                if (incidencia.value === '1'){
                    tipo_incidencia.style.display = 'block';

                }else{
                    tipo_incidencia.style.display = 'none';
                    prueba_incidencia.style.display = 'none';
                    
                }
            };

            condicion_alimentos.onchange = function(){
                if (condicion_alimentos.value === 'mala'){
                    incidencia.value = '1';
                    tipo_incidencia.style.display = 'block';
                }
            }
            // Formulario if //


            const datos_entrega = JSON.parse(document.getElementById('datos-entrega').textContent);

            const nombre_proveedor = document.getElementById('nombre_proveedor')
            const raciones_a_recibir = document.getElementById('raciones_a_recibir')
            const raciones_recibidas = document.getElementById('raciones_recibidas')
            const tanda_ce = document.getElementById('tanda_ce')
            const tipo_producto = document.getElementById('tipo_producto')

            const entregaRacionesForm = document.getElementById('entrega-raciones-form')
            const recibioSegunMenuInput = document.getElementById('entrega_segun_menu')
            const condiciones = document.getElementById('condiciones')
            const tanda = document.getElementById('tanda')
            const comentario = document.getElementById('comentario')

            const periodo_escolar = document.getElementById('periodo_escolar')
            const distrito_ce = document.getElementById('periodo_escolar')
            const regional_ce = document.getElementById('periodo_escolar')

            


            const url = window.location.href
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');

            //para borrar tanda repetidas

            let tandas = []
            for(let tanda of tanda_ce.childNodes){
                if(tandas.includes(tanda.textContent)){
                  tanda.remove(); 
                } else {
                    tandas.push(tanda.textContent)
                }
            }

            //elegir tanda
            if(tanda_ce) 
            tanda_ce.addEventListener("input", e => {

                tipo_producto.textContent = ''

                for(let registro of datos_entrega){

                    if (registro.tanda_ce == e.target.value) {
                        let option = document.createElement('option')
                        option.value = registro.producto_alimento_ce
                        option.textContent = registro.producto_alimento_ce
                        tipo_producto.appendChild(option)
                                    
                    }

                                
                }

                nombre_proveedor.value = datos_entrega[0].nombre_oferente
                raciones_a_recibir.value = datos_entrega[0].matricula_tanda_ce
                raciones_recibidas.setAttribute('max', datos_entrega[0].matricula_tanda_ce)


            });

            //elegir producto alimento
            if(tipo_producto) 
            tipo_producto.addEventListener("input", e => {
                
                for(let registro of datos_entrega){

                    if (registro.producto_alimento_ce == e.target.value && registro.tanda_ce == tanda_ce.value) {
                        nombre_proveedor.value = registro.nombre_oferente
                        raciones_a_recibir.value = registro.matricula_tanda_ce
                        raciones_recibidas.setAttribute('max', registro.matricula_tanda_ce)
                        
                                    
                    }

                                
                }

                


            });



            if(recibioSegunMenuInput)
            recibioSegunMenuInput.addEventListener("input", e => {
                if(e.target.value == "1" && condiciones.value == "buena"){
                    comentario.removeAttribute("required")
                    comentario.removeAttribute("minlength")
                } else {
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                }
            });

            if(condiciones)
            condiciones.addEventListener("input", e => {
                if(e.target.value == "buena" && recibioSegunMenuInput.value == "1"){
                    comentario.removeAttribute("required")
                    comentario.removeAttribute("minlength")
                } else {
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                }
            });


            entregaRacionesForm.addEventListener("submit", () => {
                
            });



        </script>
    </body>
</html>
