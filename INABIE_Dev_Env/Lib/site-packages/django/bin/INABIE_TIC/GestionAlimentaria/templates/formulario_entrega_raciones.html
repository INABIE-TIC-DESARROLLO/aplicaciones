<!DOCTYPE html>
<html lang="es">
    <head>
        {% load static %}
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>INABIE - Formulario Entrega raciones</title>
        <link rel="icon" href="https://inabie.gob.do/images/imagenes/logo.jpg">
        <!-- <link rel="stylesheet" href="{% static '/bootstrap-5.1.3-dist/css/bootstrap.css' %}"> -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    

        <style>
            body{
                background: #f5f4f4;
                background: linear-gradient(to right, #d9112830, #3283f57d);
            }
            h1, h2{
                color: #003970;
            }
            .h2-color{
                color: white;
            }
            .tamaño-titulo{
                /* background-color: rgb(34, 39, 195); */
                font-size: 27px;
            }

        </style>

    </head>
    <body>
        <!-- <div class="container col-12 col-md-6">
            
            <nav class="navbar navbar-dark bg-primary mt-2 shadow">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">FORMULARIO DE ENRTREGA DE RACIONES</span>
            </div>
            </nav>
        </div> -->

        <!-- <div class="col-12">
            <h2 class="h2-color p-3 mt-2 shadow-lg tamaño-titulo bg-primary">FORMULARIO DE ENRTREGA DE RACIONES</h2>

        </div> -->
        <nav class="navbar navbar-light bg-light mt-2 shadow">
            <div class="container">
            <a class="navbar-brand" href="#">
                <img src="https://inabie.gob.do/images/imagenes/LOGO-MOSCA-02.png" width="" alt="" height="80">
            </a>
            <h2>INABIE - PAE - GESTIÓN ALIMENTARIA</h2>
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                
                <div class="enlaces collapse navbar-collapse">
                    <div class="navbar-nav enlaces">
                    <a class="nav-link active" aria-current="page" href="#">BIENVENIDO/A, {{user.first_name}} {{user.last_name}}</a>
                    <a class="nav-link" href="/gestion-alimentaria/logout">CERRAR SESIÓN</a>
                    </div>
                </div>
                </div>
            </nav>
            </div>
        </nav>
        
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="col mt-5 mb-5 p-5 rounded bg-white shadow">

                        <!-- FORMULARIO -->
                        <form class="row g-3" id="entrega-raciones-form" method="post">
                            {% csrf_token %}

                            <!-- ---------------------------------------- -->
                            <!--** SECCION DATOS DEL CECNTRO EDUCATIVO **-->
                            <!-- ---------------------------------------- -->
                            
                            <h1>Datos del Centro Educativo</h1>

                            <div class="col-md-4 was-validated">
                                <label for="periodo_escolar" class="form-label">Periodo Escolar</label>
                                <input type="text" class="form-control" name="periodo_escolar" id="periodo_escolar" placeholder="" value="{{datos_entrega_consultada.periodo_escolar_desde}}-{{datos_entrega_consultada.periodo_escolar_hasta}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="distrito_ce" class="form-label">Distrito</label>
                                <input type="text" class="form-control" name="distrito_ce" id="distrito_ce" placeholder="" value="{{datos_entrega_consultada.distrito_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="regional_ce" class="form-label">Regional</label>
                                <input type="text" class="form-control" name="regional_ce" id="regional_ce" placeholder="" value="{{datos_entrega_consultada.regional_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="codigo_ce" class="form-label">Código</label>
                                <input type="text" class="form-control" name="codigo_ce" id="codigo_ce" placeholder="" value="{{datos_entrega_consultada.codigo_ce}}" autocomplete="off" required readonly>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="nombre_ce" class="form-label">Nombre</label>
                                <input type="text" class="form-control" name="nombre_ce" id="nombre_ce" placeholder="" value="{{datos_entrega_consultada.nombre_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated d-none">
                                <label for="servicio_modalidad" class="form-label">Servicio/Modalidad</label>
                                <input type="text" class="form-control" name="servicio_modalidad" id="servicio_modalidad" placeholder="" value="{{datos_entrega_consultada.servicio_modalidad_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="provincia_ce" class="form-label">Provincia</label>
                                <input type="text" class="form-control" name="provincia_ce" id="provincia_ce" placeholder="" value="{{datos_entrega_consultada.provincia_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="municipio_ce" class="form-label">Municipio</label>
                                <input type="text" class="form-control" name="municipio_ce" id="municipio_ce" placeholder="" value="{{datos_entrega_consultada.municipio_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated d-none">
                                <label for="sector_ce" class="form-label">Sector</label>
                                <input type="text" class="form-control" name="sector_ce" id="sector_ce" placeholder="" value="{{datos_entrega_consultada.sector_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated d-none">
                                <label for="direccion_ce" class="form-label">Dirección</label>
                                <input type="text" class="form-control" name="direccion_ce" id="direccion_ce" placeholder="" value="{{datos_entrega_consultada.direccion_ce}}" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated d-none">
                                <label for="telefono_ce" class="form-label">Telefono</label>
                                <input type="text" class="form-control" name="telefono_ce" id="telefono_ce" placeholder="" value="{{datos_entrega_consultada.telefono_ce}}" autocomplete="off" required  readonly>
                            </div>
                            
                           <!-- Datos ocultos del director -->
                            
                           <div class="col-md-4 was-validated d-none">
                                <label for="cedula_director" class="form-label">Cedula Director</label>
                                <input type="text" class="form-control" name="cedula_director" id="cedula_director" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>

                           <div class="col-md-4 was-validated d-none">
                                <label for="nombre_director" class="form-label">Nombre Director</label>
                                <input type="text" class="form-control" name="nombre_director" id="nombre_director" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>

                           <div class="col-md-4 was-validated d-none">
                                <label for="telefono_director" class="form-label">Telefono Director</label>
                                <input type="text" class="form-control" name="telefono_director" id="telefono_director" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>

                           <div class="col-md-4 was-validated d-none">
                                <label for="email_director" class="form-label">Telefono Director</label>
                                <input type="text" class="form-control" name="email_director" id="email_director" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>
                        
                           <!-- datos del analista de seguimiento al servicio de alimentacion -->

                           <div class="col-md-4 was-validated d-none">
                                <label for="nombre_analista_seguimiento_servicio" class="form-label">Nombre Analista de seguimiento</label>
                                <input type="text" class="form-control" name="nombre_analista_seguimiento_servicio" id="nombre_analista_seguimiento_servicio" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>

                           <div class="col-md-4 was-validated d-none">
                                <label for="cedula_analista_seguimiento_servicio" class="form-label">Cedula Analista de seguimiento</label>
                                <input type="text" class="form-control" name="cedula_analista_seguimiento_servicio" id="cedula_analista_seguimiento_servicio" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>

                           <div class="col-md-4 was-validated d-none">
                                <label for="telefono_analista_seguimiento_servicio" class="form-label">Telefono Analista de seguimiento</label>
                                <input type="text" class="form-control" name="telefono_analista_seguimiento_servicio" id="telefono_analista_seguimiento_servicio" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>

                           <div class="col-md-4 was-validated d-none">
                                <label for="email_analista_seguimiento_servicio" class="form-label">Email Analista de seguimiento</label>
                                <input type="text" class="form-control" name="email_analista_seguimiento_servicio" id="email_analista_seguimiento_servicio" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>

                           <div class="col-md-4 was-validated d-none">
                                <label for="cargo_analista_seguimiento_servicio" class="form-label">Email Analista de seguimiento</label>
                                <input type="text" class="form-control" name="cargo_analista_seguimiento_servicio" id="cargo_analista_seguimiento_servicio" placeholder="" value="" autocomplete="off" required  readonly>
                           </div>

                           <!-- datos del proveedor -->

                            <h1>Datos de la Recepción de Alimentos</h1>

                            <div class="col-md-4 was-validated">
                                <label for="nombre_proveedor" class="form-label">Proveedor</label>
                                <input type="text" class="form-control" name="nombre_proveedor" id="nombre_proveedor" value="{{datos_entrega_consultada.nombre_prov}}" placeholder="" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="tanda_ce" class="form-label">Tanda</label>
                                <select name="tanda_ce" id="tanda_ce" class="form-select" required>
                                    <option selected></option>


                                    {% for datos in datos_entrega %}                                       

                                            <option value="{{datos.tanda_ce}}">{{datos.tanda_ce}}</option>
                                        
                                    {% endfor %}
                                    
                                    
                                </select>
                            </div>
                            
                            <div class="col-md-4 was-validated d-none">
                                <label for="cedula_proveedor" class="form-label">Cedula Proveedor</label>
                                <input type="text" class="form-control" name="cedula_proveedor" id="cedula_proveedor" value="{{datos_entrega_consultada.cedula_prov}}" placeholder="" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated d-none">
                                <label for="telefono_proveedor" class="form-label">Telefono Proveedor</label>
                                <input type="text" class="form-control" name="telefono_proveedor" id="telefono_proveedor" value="{{datos_entrega_consultada.telefono_prov}}" placeholder="" autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated d-none">
                                <label for="email_proveedor" class="form-label">Telefono Proveedor</label>
                                <input type="text" class="form-control" name="email_proveedor" id="email_proveedor" value="{{datos_entrega_consultada.email_prov}}" placeholder="" autocomplete="off" required  readonly>
                            </div>

                            <!-- datos de la entrega de raciones -->
                            
                            <div class="col-md-4 was-validated">
                                <label for="tipo_producto" class="form-label">Alimentos (mostrados según la tanda)</label>
                                <select name="tipo_producto" id="tipo_producto" class="form-select" required>

                                    <!-- {% for datos in datos_entrega %}
                                        {% if  datos.tanda_ce == datos_entrega_consultada.tanda_ce %} {% comment %} Solo mostrar los productos que pertenecen a la tanda seleccionada {% endcomment %}

                                            {% if datos.producto_alimento_lth == datos_entrega_consultada.producto_alimento_lth%}
                                                <option value="{{datos.producto_alimento_lth}}" selected>{{datos.producto_alimento_lth}}</option>
                                            {% else %}
                                                <option value="{{datos.producto_alimento_lth}}">{{datos.producto_alimento_lth}}</option>
                                            {% endif %}

                                        {% endif %}
                                        
               
                                    {% endfor %} -->
                                </select>
                            </div>

                            

                            <div class="col-md-4 was-validated d-none">
                                <label for="raciones_periodo" class="form-label ">Raciones del periodo</label>
                                <input type="text" class="form-control" name="raciones_periodo" id="raciones_periodo" placeholder="Ingrese raciones de periodo..." autocomplete="off" required  readonly>
                            </div>

                            <div class="col-md-4 was-validated d-none">
                                <label for="raciones_consumidas" class="form-label">Raciones consumidas</label>
                                <input type="text" class="form-control" name="raciones_consumidas" id="raciones_consumidas" placeholder="Ingrese raciones consumidas..." autocomplete="off" required readonly>
                            </div>

                            <!-- <div class="col-md-4 was-validated d-none">
                                <label for="frecuencia_entrega" class="form-label">Frecuencia Entrega</label>
                                <select name="frecuencia_entrega" id="frecuencia_entrega" class="form-select" required readonly>
                                    <option></option>
                                    <option>Diario</option>
                                    <option>Semanal</option>
                                </select>
                            </div> -->

                            <div class="col-md-4 was-validated">
                                <label for="raciones_a_recibir" class="form-label">Raciones a recibir</label>
                                <input type="text" class="form-control" name="raciones_a_recibir" id="raciones_a_recibir" placeholder="Ingrese raciones consumidas..." value="{{datos_entrega_consultada.lote_raciones_diarias_total_ltd}}" autocomplete="off" required readonly>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="raciones_recibidas" class="form-label">Raciones recibidas</label>
                                <input type="number" class="form-control" name="raciones_recibidas" id="raciones_recibidas" placeholder="Ingrese raciones recibidas..." autocomplete="off" required required min="1" max="{{datos_entrega_consultada.lote_raciones_diarias_total_ltd}}" >
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="condicion_raciones" class="form-label">Condiciones</label>
                                <select name="condicion_raciones" id="condicion_raciones" class="form-select" required >
                                    <option></option>
                                    <option value="buena">Buena</option>
                                    <option value="regular">Regular</option>
                                    <option value="mala">Mala</option>
                                </select>
                            </div>

                            <div class="col-md-4 was-validated">
                                <label for="entrega_segun_menu" class="form-label">¿Recibió los alimentos especificados en el menú?</label>
                                <select name="entrega_segun_menu" id="entrega_segun_menu" class="form-select" required >
                                    <option></option>
                                    <option value="1">Sí</option>
                                    <option value="0">No</option>
                                </select>
                            </div>

                            <div class="col-md-12 was-validated">
                                <label for="comentario" class="form-label">Comentario:</label>
                                <textarea name="comentario" id="comentario" cols="10" rows="2" class="form-control" maxlength="300"></textarea>

                            </div>
                            


                            <div class="d-grid mt-5">
                                <button type="submit" class="btn btn-primary">Enviar</button>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>


        <!-- <script src="{% static '/jquery-3.6.0.js' %}"></script>
        <script src="{% static '/popper.min.js' %}"></script>
        <script src="{% static '/bootstrap-5.1.3-dist/js/bootstrap.js' %}"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>

        {{datos_entrega|json_script:"datos-entrega"}}

        <script>
            
            const datos_entrega = JSON.parse(document.getElementById('datos-entrega').textContent);

            const nombre_proveedor = document.getElementById('nombre_proveedor')
            const raciones_a_recibir = document.getElementById('raciones_a_recibir')
            const raciones_recibidas = document.getElementById('raciones_recibidas')
            const tanda_ce = document.getElementById('tanda_ce')
            const tipo_producto = document.getElementById('tipo_producto')

            const entregaRacionesForm = document.getElementById('entrega-raciones-form')
            const recibioSegunMenuInput = document.getElementById('entrega_segun_menu')
            const condiciones = document.getElementById('condiciones')
            const tanda = document.getElementById('tanda')
            const comentario = document.getElementById('comentario')

            const periodo_escolar = document.getElementById('periodo_escolar')
            const distrito_ce = document.getElementById('periodo_escolar')
            const regional_ce = document.getElementById('periodo_escolar')

            


            const url = window.location.href
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');

            //para borrar tanda repetidas

            let tandas = []
            for(let tanda of tanda_ce.childNodes){
                if(tandas.includes(tanda.textContent)){
                  tanda.remove(); 
                } else {
                    tandas.push(tanda.textContent)
                }
            }

            //elegir tanda
            if(tanda_ce) 
            tanda_ce.addEventListener("input", e => {

                tipo_producto.textContent = ''

                for(let registro of datos_entrega){

                    if (registro.tanda_ce == e.target.value) {
                        let option = document.createElement('option')
                        option.value = registro.producto_alimento_lth
                        option.textContent = registro.producto_alimento_lth
                        tipo_producto.appendChild(option)
                                    
                    }

                                
                }

                nombre_proveedor.value = datos_entrega[0].nombre_prov
                raciones_a_recibir.value = datos_entrega[0].lote_raciones_diarias_total_ltd
                raciones_recibidas.setAttribute('max', datos_entrega[0].lote_raciones_diarias_total_ltd)


            });

            //elegir producto alimento
            if(tipo_producto) 
            tipo_producto.addEventListener("input", e => {
                
                for(let registro of datos_entrega){

                    if (registro.producto_alimento_lth == e.target.value && registro.tanda_ce == tanda_ce.value) {
                        nombre_proveedor.value = registro.nombre_prov
                        raciones_a_recibir.value = registro.lote_raciones_diarias_total_ltd
                        raciones_recibidas.setAttribute('max', registro.lote_raciones_diarias_total_ltd)
                        
                                    
                    }

                                
                }

                


            });



            if(recibioSegunMenuInput)
            recibioSegunMenuInput.addEventListener("input", e => {
                if(e.target.value == "1" && condiciones.value == "buena"){
                    comentario.removeAttribute("required")
                    comentario.removeAttribute("minlength")
                } else {
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                }
            });

            if(condiciones)
            condiciones.addEventListener("input", e => {
                if(e.target.value == "buena" && recibioSegunMenuInput.value == "1"){
                    comentario.removeAttribute("required")
                    comentario.removeAttribute("minlength")
                } else {
                    comentario.setAttribute("required", '')
                    comentario.setAttribute("minlength", 50)
                }
            });


            entregaRacionesForm.addEventListener("submit", () => {
                
            });



        </script>
    </body>
</html>




