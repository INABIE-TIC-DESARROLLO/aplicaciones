<!DOCTYPE html>
<html lang="es">
    <head>
        {% load static %}
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>INABIE GeoApp</title>
        <link rel="icon" href="{% static './logo.jpg' %}">
        <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
        <link rel="stylesheet" href="{% static '/bootstrap-5.1.3-dist/css/bootstrap.css' %}">
        <style>
            #map {
              height: 100%;
            }
            html, body {
              height: 100%;
              margin: 0;
              padding: 0;
            }

            .navbar{
                position: absolute;
                top: 0;
                width: 100%;
                background-color: white;
            }

            .navbar-brand img{
                width: 5rem;
                height: 5rem;
            }

            .loader{
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 50%;
            }

            .loader .spinner-border{

                width: 7rem;
                height: 7rem;
            }

            .modo-visualizacion .active{
                background-color: #1f3d73;
                color: aliceblue !important;
            }

            .modo-ejecucion .active{
                background-color: #1f3d73;
                color: aliceblue !important;
            }
        </style>

        
    </head>
    <body>



        <div id="map"></div>

        <nav class="navbar navbar-expand-lg navbar-light bg-light d-flex">
            <div class="container-fluid d-flex justify-content-center mx-auto">
              <a class="navbar-brand"><img src="{% static 'imagenes/logo.jpg' %}" alt="INABIE"></a>

              <h1 class="ms-5 me-5 text-center fs-4">PAE-JEE</h1>
              <h2 class="ms-1 me-1 text-center fs-6">Bienvenido/a {{user}}</h2>

              <div class="collapse navbar-collapse mx-auto d-flex justify-content-center" id="navbarSupportedContent">
                
                    <ul class="navbar-nav mx-auto mb-lg-0">


                        <li class="nav-item me-3 dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown-herramientas" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Herramientas
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown-herramientas">
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modal-filter">Filtros</a></li>
                            <li><hr class="dropdown-divider">Cálculos</li>
                            <li><a id="calcular-ruta-e-indicadores" class="dropdown-item" href="" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">Ruta e indicadores</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown me-3">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown-servicio" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Servicio/Modalidad
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown-servicio">
                                <li><a class="dropdown-item" href="#">Jornada extendida urbano</a></li>
                                <li><a class="dropdown-item" href="#">Jornada extendida rural</a></li>
                                <!-- <li><hr class="dropdown-divider">Buscar lugar</li> -->
                                <li><a class="dropdown-item" href="#">Urbano</a></li>
                                <li><a class="dropdown-item" href="#">Rural</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown me-3">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown-info" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Info
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown-info">
                                <li><a class="dropdown-item" href="#" id="leyenda" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrollingInfo" aria-controls="offcanvasScrollingInfo">Leyenda</a></li>
                                <li><a class="dropdown-item" href="#" id="ubicaciones-repetidas" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrollingInfo" aria-controls="offcanvasScrollingInfo">Ubicaciones Repetidas</a></li>
                            </ul>
                        </li>
                        <li class="nav-item me-3">
                            <a class="nav-link" href="/admin" target="_blank" rel="noopener noreferrer">Administración</a>
                        </li>
                        
                        <li class="nav-item me-3">
                            <a class="nav-link" href="/geoapp/logout">Cerrar Sesión</a>
                        </li>
                    </ul>

                    <form id="buscador-marcador" class="d-flex ">
                        <div class="btn-group ms-0 me-3" role="group" aria-label="Basic radio toggle button group">
                            <input type="radio" class="btn-check" name="btnradio" id="escuelas-radio-button" autocomplete="off" checked>
                            <label class="btn btn-outline-success" for="escuelas-radio-button">Escuela</label>
                                
                            <input type="radio" class="btn-check" name="btnradio" id="oferentes-radio-button" autocomplete="off">
                            <label class="btn btn-outline-primary" for="oferentes-radio-button">Oferente</label>
                                
                        
                        </div> 
                        <input id="valor-a-buscar" class="form-control me-2" type="search" placeholder="Código o Cédula/RNC, etc" aria-label="Search">
                        <button id="boton-buscar-marcador" class="btn btn-outline-primary" type="submit">Buscar</button>
                    </form>

              </div>
            </div>
        </nav>

        <!-- NavSide Left-->
        <div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="offcanvasScrollingLabel">Cálculo de ruta e indicadores</h5>
              <button id="close-offcanvas" type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">

                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                      <button class="nav-link" id="origen-tab-filter" data-bs-toggle="tab" data-bs-target="#origen-tab-content" type="button" role="tab" aria-controls="origen-tab-content" aria-selected="false">Origen</button>
                      <button class="nav-link" id="paradas-tab-filter" data-bs-toggle="tab" data-bs-target="#paradas-tab-content" type="button" role="tab" aria-controls="paradas-tab-content" aria-selected="false">Paradas</button>
                      <button class="nav-link" id="destino-tab-filter" data-bs-toggle="tab" data-bs-target="#destino-tab-content" type="button" role="tab" aria-controls="destino-tab-content" aria-selected="false">Destino</button>
                      
                    </div>
                </nav>

                <div class="tab-content" id="nav-tabContent">
                    
                    <div class="tab-pane fade show active mt-3 mb-2" id="origen-tab-content" role="tabpanel" aria-labelledby="origen-tab-content">


                    </div>

                    <div class="tab-pane fade mt-3 mb-2" id="paradas-tab-content" role="tabpanel" aria-labelledby="paradas-tab-content">

                        
                    </div>

                    <div class="tab-pane fade mt-3 mb-2" id="destino-tab-content" role="tabpanel" aria-labelledby="destino-tab-content">

                        
                    </div>

                </div>

                <div class="d-grid gap-2 mt-5 mb-5">
                    <button id="offcanvas-calcular-ruta-button" class="btn btn-secondary" type="button">Calcular</button>
                </div>

                <h1 class="fs-5 text-center">Detalles del viaje</h1>

                <ul id="recuento-distancia-y-tiempo" class="list-group mt-2 mb-2">               

                    <li id="recuento-distancia" class="list-group-item list-group-item-secondary">Distancia Total: <strong></strong> km</li>
                    <li id="recuento-tiempo" class="list-group-item list-group-item-dark">Tiempo Total: <strong></strong> min</li>
                    <li id="recuento-raciones" class="list-group-item list-group-item-dark">Total Raciones: <strong></strong></li>

                </ul>

                <div id="offcanvas-detalles-del-viaje"></div>
                

            </div>
          </div>

        <!-- NavSide Bottom-->
        <div class="offcanvas offcanvas-bottom" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrollingInfo" aria-labelledby="offcanvasScrollingInfoLabel">
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="offcanvasScrollingInfoLabel"></h5>
              <button id="close-offcanvas-bottom" type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body" id="offcanvasScrollingInfoBody">

                
                

            </div>
          </div>

        <div class="modal fade" id="modal-filter" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Filtros</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h1 class="fs-5">Mostrar/Ocultar</h1>
                    <div class="form-check form-check-inline mt-3 mb-3">
                        <input class="form-check-input" type="checkbox" id="escuelas-check" value="option1" checked>
                        <label class="form-check-label" for="escuelas-check">Escuelas</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="oferentes-check" value="option2" checked>
                        <label class="form-check-label" for="oferentes-check">Oferentes</label>
                    </div>

                    <h2 class="fs-5">Filtrar</h2>
                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                          <button class="nav-link active" id="escuelas-tab-filter" data-bs-toggle="tab" data-bs-target="#escuelas-tab-content" type="button" role="tab" aria-controls="escuelas-tab-content" aria-selected="true">Escuelas</button>
                          <button class="nav-link" id="oferentes-tab-filter" data-bs-toggle="tab" data-bs-target="#oferentes-tab-content" type="button" role="tab" aria-controls="oferentes-tab-content" aria-selected="false">Oferentes</button>
                          
                        </div>
                    </nav>

                    <div class="tab-content" id="nav-tabContent">
                        
                        <div class="tab-pane fade show active" id="escuelas-tab-content" role="tabpanel" aria-labelledby="escuelas-tab-content">

                            
                            <div id="filtros-escuelas">
                                <form class="row g-3 mt-3 mb-3">
                                    <div class="col-md-6">
                                      <label for="regional-escuela" class="form-label">Regional</label>
                                      <select id="regional-escuela" class="form-select" aria-label="Default select example">
                                        <option selected></option>
                                        
                                        {% for regional in regionales %}
                                            <option value="{{regional}}">{{regional}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
    
                                    
    
                                    <div class="col-md-6">
                                      <label for="distrito-escuela" class="form-label">Distrito</label>
                                      <select id="distrito-escuela" class="form-select" aria-label="Default select example">
                                        <option selected></option>
                                        
                                        {% for distrito in distritos %}
                                            <option value="{{distrito}}">{{distrito}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
    
                                    <div class="col-md-10">
                                      <label for="provincia-escuela" class="form-label">Provincia</label>
                                      <select id="provincia-escuela" class="form-select" aria-label="Default select example">
                                        <option selected></option>
                                        
                                        {% for provincia in provincias %}
                                            <option value="{{provincia}}">{{provincia}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
                                    
                                    <div class="col-md-10">
                                      <label for="municipio-escuela" class="form-label">Municipio</label>
                                      <select id="municipio-escuela" class="form-select" aria-label="Default select example">
                                        <option selected></option>
                                        
                                        {% for municipio in municipios %}
                                            <option value="{{municipio}}">{{municipio}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
    
                                    <div class="col-md-4">
                                      <label for="lote-escuela" class="form-label">Lote</label>
                                      <input type="text" class="form-control" id="lote-escuela">
                                    </div>
    
                                    <h1 class="fs-5">Por cantidad de raciones</h1>
    
                                    <div class="col-md-4">
                                      <label for="mayor-a-raciones" class="form-label">Mayor a</label>
                                      <input type="number" class="form-control" id="mayor-a-raciones">
                                    </div>
    
                                    <div class="col-md-4">
                                      <label for="menor-a-raciones" class="form-label">Menor a</label>
                                      <input type="number" class="form-control" id="menor-a-raciones">
                                    </div>
                                    
                                </form>
                            </div>

                        </div>

                        <div class="tab-pane fade" id="oferentes-tab-content" role="tabpanel" aria-labelledby="oferentes-tab-content">

                            <div id="filtros-oferentes">
                                <div class="d-grid gap-2 mt-2 mb-2">
                                    <button id="rellenar-campos-filtro-oferentes-button" class="btn btn-primary" type="button">Rellenar igual que filtro de escuelas</button>
                                </div>
                                <form class="row g-3 mt-3 mb-3">
                                    <div class="col-md-6">
                                      <label for="regional-oferente" class="form-label">Regional</label>
                                      <select id="regional-oferente" class="form-select" aria-label="Default select example">
                                        <option selected></option>
                                        
                                        {% for regional in regionales %}
                                            <option value="{{regional}}">{{regional}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
    
                                    
    
                                    <div class="col-md-6">
                                      <label for="distrito-oferente" class="form-label">Distrito</label>
                                      <select id="distrito-oferente" class="form-select" aria-label="Default select example">
                                        <option selected></option>
                                        
                                        {% for distrito in distritos %}
                                            <option value="{{distrito}}">{{distrito}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
    
                                    <div class="col-md-10">
                                      <label for="provincia-oferente" class="form-label">Provincia</label>
                                      <select id="provincia-oferente" class="form-select" aria-label="Default select example">
                                        <option selected></option>
                                        
                                        {% for provincia in provincias %}
                                            <option value="{{provincia}}">{{provincia}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
                                    
                                    <div class="col-md-10">
                                      <label for="municipio-oferente" class="form-label">Municipio</label>
                                      <select id="municipio-oferente" class="form-select" aria-label="Default select example">
                                        <option selected></option>
                                        
                                        {% for municipio in municipios %}
                                            <option value="{{municipio}}">{{municipio}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
    
                                    <div class="col-md-4">
                                      <label for="lote-oferente" class="form-label">Lote</label>
                                      <input type="text" class="form-control" id="lote-oferente">
                                    </div>
    
                                    <h1 class="fs-5">Por distancia a escuelas</h1>
    
                                    <div class="col-md-4">
                                      <label for="mayor-a-distancia" class="form-label">Mayor a</label>
                                      <input type="number" class="form-control" id="mayor-a-distancia">
                                    </div>
    
                                    <div class="col-md-4">
                                      <label for="menor-a-distancia" class="form-label">Menor a</label>
                                      <input type="number" class="form-control" id="menor-a-distancia">
                                    </div>
    
                                    <h2 class="fs-5">Por tiempo a escuelas</h1>
    
                                    <div class="col-md-4">
                                      <label for="mayor-a-tiempo" class="form-label">Mayor a</label>
                                      <input type="number" class="form-control" id="mayor-a-tiempo">
                                    </div>
    
                                    <div class="col-md-4">
                                      <label for="menor-a-tiempo" class="form-label">Menor a</label>
                                      <input type="number" class="form-control" id="menor-a-tiempo">
                                    </div>
    
            
                                    
                                </form>
                            </div>
                        </div>
                    </div>

                  
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                  <button id="aplicar-filtros-button" type="button" class="btn btn-success" data-bs-dismiss="modal">Aplicar</button>
                </div>
              </div>
            </div>
          </div>


        <div id="loader" class="loader d-flex justify-content-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
        </div>

        <div id="error-toast" class="toast align-items-center text-white bg-danger border-0 position-absolute top-0 start-50 translate-middle-x mt-5" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
              <div id="toast-text-value" class="toast-body">
                Hello, world! This is a toast message.
              </div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto close-toast-button" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>

        <div id="info-toast" class="toast align-items-center text-white bg-warning border-0 position-absolute top-0 start-50 translate-middle-x mt-5" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Detalles del filtrado</strong>
                <!-- <small>11 mins ago</small> -->
                <button type="button" class="btn-close me-2 m-auto close-toast-button" data-bs-dismiss="toast" aria-label="Close"></button>
              </div>
              <div id="info-toast-text-value" class="toast-body text-center fs-4">
                Hello, world! This is a toast message.
              </div>
            </div>
        </div>
        
        <script src="{% static '/jquery-3.6.0.js' %}"></script>
        <script src="{% static '/popper.min.js' %}"></script>
        <script src="{% static '/bootstrap-5.1.3-dist/js/bootstrap.js' %}"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDwul2_Z-uoaTPj0JXn0wpdhbqejNTr-Nc&callback=initMap&v=weekly" async></script>
        
      
        <script>

            const host = 'http://' + window.location.host + '/admin/PAE'
            let modo = 'visualizacion' //segun la modalidad estaran disponibles diferentes funciones para los marcadores
            let modoAnterior = 'visualizacion' //para volver al modo anterior despues de terminar de utilizar uno
            let funcionModo = ''; //funcion a ejecutar en el modo seleccionado 

            let map;
            let origin = {lat: 19.3309, lng: -70.5309};
            let directionsService; //Objeto de google que proporciona los metodos para calcular rutas: distancia y tiempo
            let directionsRenderer; //Objeto de google que nos permite mostrar la informacion de la ruta calculada

            function initMap() {
                map = new google.maps.Map(document.getElementById("map"), {
                    center: origin,
                    zoom: 8,
                    mapTypeControl: true,
                    mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
                    position: google.maps.ControlPosition.LEFT_CENTER,
                    },
                    zoomControl: true,
                    zoomControlOptions: {
                    position: google.maps.ControlPosition.LEFT_BOTTOM,
                    },
                    scaleControl: true,
                    streetViewControl: true,
                    streetViewControlOptions: {
                    position: google.maps.ControlPosition.LEFT_BOTTOM,
                    },
                    fullscreenControl: false,
                });

                const trafficLayer = new google.maps.TrafficLayer();
                trafficLayer.setMap(map);
                directionsService = new google.maps.DirectionsService();
                directionsRenderer = new google.maps.DirectionsRenderer({
                    polylineOptions: {
                        strokeColor: '#ed6b03',
                        strokeOpacity: 0.5,
                        strokeWeight: 11
                    }
                });

                let infoWindow = new google.maps.InfoWindow({
                    content: "Haz Click en cualquier punto del mapa para obtener latitud y longitud",
                    position: origin,
                });

                infoWindow.open(map);
                // Configure the click listener.

                map.addListener("click", (mapsMouseEvent) => {
                    // Close the current InfoWindow.
                    infoWindow.close();
                    // Create a new InfoWindow.
                    infoWindow = new google.maps.InfoWindow({
                    position: mapsMouseEvent.latLng,
                    });
                    infoWindow.setContent(
                    JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
                    );
                    infoWindow.open(map);
                });
            }


            const ws = new WebSocket('ws://' + window.location.host + '/geoapp/');

            ws.onopen = (e => {

            })
            
            let escuelas;
            let oferentes;
            let codigosEscuelas; //obtener codigos de escuela que son las key en el json 
            let cedulasRncOferentes; // cedulas o rnc son las key
            let marcadoresEscuelas = [];
            let marcadoresOferentes = [];


            ws.onmessage = e => {
                let data = JSON.parse(e.data)

                if(data['codigo']){

                    if(codigosEscuelas.includes(data['codigo'])){

                        if(data['accion'] == 'eliminar'){
                            escuelas[data['codigo']].marcadorObj.infoWindow.close();
                            escuelas[data['codigo']].marcadorObj.infoWindow = null;
                            escuelas[data['codigo']].marcadorObj.marcador.setMap(null);
                            escuelas[data['codigo']].marcadorObj.marcador = null;

                            delete escuelas[data['codigo']];
                            let i = escuelas.indexOf(data['codigo'])
                            escuelas.splice(i, 1);
                        } else {
                            escuelas[data['codigo']].marcadorObj.infoWindow.close();
                            escuelas[data['codigo']].marcadorObj.infoWindow = null;
                            escuelas[data['codigo']].marcadorObj.marcador.setMap(null);
                            escuelas[data['codigo']].marcadorObj.marcador = null;

                            escuelas[data['codigo']] = data; //si existe la modifica y si no, la crea

                            cargarEscuelas([data['codigo']], escuelas);

                            escuelas[data['codigo']].marcadorObj.marcador.setAnimation(google.maps.Animation.BOUNCE);

                            setTimeout(() => {
                                escuelas[data['codigo']].marcadorObj.marcador.setAnimation(null);
                            }, 5000);

                        }


                    } else {
                        escuelas[data['codigo']] = data; //si existe la modifica y si no, la crea

                        cargarEscuelas([data['codigo']], escuelas);

                        escuelas[data['codigo']].marcadorObj.marcador.setAnimation(google.maps.Animation.BOUNCE);

                        setTimeout(() => {
                            escuelas[data['codigo']].marcadorObj.marcador.setAnimation(null);
                        }, 5000);
                        
                    }

                    

                } else if(data['cedula_rnc']){

                    if(data['accion'] == 'eliminar'){
                        oferentes[data['cedula_rnc']].marcadorObj.infoWindow.close();
                        oferentes[data['cedula_rnc']].marcadorObj.infoWindow = null;
                        oferentes[data['cedula_rnc']].marcadorObj.marcador.setMap(null);
                        oferentes[data['cedula_rnc']].marcadorObj.marcador = null;
                        
                        delete oferentes[data['cedula_rnc']];
                        let i = oferentes.indexOf(data['cedula_rnc'])
                        oferentes.splice(i, 1);
                        

                    } else {
                        if(cedulasRncOferentes.includes(data['cedula_rnc'])){

                            oferentes[data['cedula_rnc']].marcadorObj.infoWindow.close();
                            oferentes[data['cedula_rnc']].marcadorObj.infoWindow = null;
                            oferentes[data['cedula_rnc']].marcadorObj.marcador.setMap(null);
                            oferentes[data['cedula_rnc']].marcadorObj.marcador = null;

                            oferentes[data['cedula_rnc']] = data; //si existe la modifica y si no, la crea

                            cargarOferentes([data['cedula_rnc']], oferentes);

                            oferentes[data['cedula_rnc']].marcadorObj.marcador.setAnimation(google.maps.Animation.BOUNCE);

                            setTimeout(() => {
                                oferentes[data['cedula_rnc']].marcadorObj.marcador.setAnimation(null);
                            }, 5000);

                        } else {
                            oferentes[data['cedula_rnc']] = data; //si existe la modifica y si no, la crea

                            cargarOferentes([data['cedula_rnc']], oferentes);

                            oferentes[data['cedula_rnc']].marcadorObj.marcador.setAnimation(google.maps.Animation.BOUNCE);

                            setTimeout(() => {
                                oferentes[data['cedula_rnc']].marcadorObj.marcador.setAnimation(null);
                            }, 5000);

                        }
                    }

                    

                } else {
                    
                    codigosEscuelas = Object.keys(data.escuelas) //obtener codigos de escuela que son las key en el json 
                    cedulasRncOferentes = Object.keys(data.oferentes) // cedulas o rnc son las key
                    escuelas = data.escuelas
                    oferentes = data.oferentes

                    cargarEscuelas(codigosEscuelas, escuelas);
                    cargarOferentes(cedulasRncOferentes, oferentes);

                }
                

            }


            function cargarEscuelas(codigosEscuelas, escuelas){


                document.getElementById('loader').classList.add('d-flex');

                for(let codigoEscuela of codigosEscuelas){

                    let icono; // para cambiar color segun condicion especial
                    if(escuelas[codigoEscuela].condicion_especial != 'NINGUNA' || escuelas[codigoEscuela].condicion_especial == '' || escuelas[codigoEscuela].condicion_especial == undefined){
                        icono = "{% static 'imagenes/marcador-escuela.svg' %}"

                    } else {
                        
                        icono = {
                            path: "M19,2A13.991,13.991,0,0,0,5,16C5,26.5,19,42,19,42S33,26.5,33,16A13.991,13.991,0,0,0,19,2Z",
                            fillColor: escuelas[codigoEscuela].color_relleno_marcador,
                            fillOpacity: 1,
                            strokeWeight: 1,
                            strokeColor: escuelas[codigoEscuela].color_borde_marcador,
                            anchor: new google.maps.Point(28, 40) //se asigna ancho y largo respectivamente del svg, esto es porque el marcador escala de manera diferente cuando asignamos un string de svg


                            }
                    }

                    let marcadorEscuela = new google.maps.Marker({
                        position: {
                        lat: Number(escuelas[codigoEscuela].latitud),
                        lng: Number(escuelas[codigoEscuela].longitud) 
                        },
                        map,
                        icon: icono,
                        title: codigoEscuela,
                        limit: 1,
                        clickable: true,
                        optimized: true,
    

                    });
                    const contentString =
                        `
                        <div class="card text-white bg-success" style="width: 18rem;">
                            <div class="card-header fs-6">
                                ${codigoEscuela} - <strong>${escuelas[codigoEscuela].nombre}</strong>
                            </div>
                            <ul class="list-group list-group-flush">
                                
                                <li class="list-group-item fs-6"><strong>Primaria: </strong>${escuelas[codigoEscuela].cantidad_primaria}</li>
                                <li class="list-group-item fs-6"><strong>Secundaria: </strong>${escuelas[codigoEscuela].cantidad_secundaria}</li>
                                <li class="list-group-item list-group-item-warning fs-6"><strong>Matriculados: </strong>${escuelas[codigoEscuela].cantidad_matriculados}</li>
                                <li class="list-group-item list-group-item-warning fs-6"><strong>Lote: </strong>${escuelas[codigoEscuela].lote}</li>
                                <li class="list-group-item fs-6"><strong>Provincia: </strong>${escuelas[codigoEscuela].provincia}</li>
                                <li class="list-group-item fs-6"><strong>Municipio: </strong>${escuelas[codigoEscuela].municipio}</li>
                                <li class="list-group-item fs-6"><strong>Regional: </strong>${escuelas[codigoEscuela].regional}</li>
                                <li class="list-group-item fs-6"><strong>Distrito: </strong>${escuelas[codigoEscuela].distrito}</li>
                                <li class="list-group-item fs-6"><strong>Dirección: </strong>${escuelas[codigoEscuela].direccion}</li>
                                <li class="list-group-item fs-6"><strong>Latitud: </strong>${escuelas[codigoEscuela].latitud}</li>
                                <li class="list-group-item fs-6"><strong>Longitud: </strong>${escuelas[codigoEscuela].longitud}</li>
                                <li class="list-group-item fs-6"><strong>Servicio: </strong>${escuelas[codigoEscuela].servicio}</li>
                                <li class="list-group-item fs-6"><strong>Condicion Especial: </strong>${escuelas[codigoEscuela].condicion_especial}</li>
                                
                                
                            </ul>

                            <a href="${host}/escuela/${codigoEscuela}" class="btn btn-warning" target="_blank" rel="noopener noreferrer">Administrar</a>
                        </div>
                        `;
                    
                    //<button id="modificar-lote-button-${codigoEscuela}" type="button" class="ms-1 me-1 btn btn-success btn-sm">Modificar</button>
                   // {% if perms.ComprasYContrataciones.change_oferente and perms.ComprasYContrataciones.change_escuela %}
                   //       <li class="list-group-item list-group-item-warning fs-6"><strong>Lote: </strong>${escuelas[codigoEscuela].lote}</li>
                    //{% endif %}

                    let infowindow = new google.maps.InfoWindow({
                        content: contentString,
                    });

                    marcadorEscuela.addListener("click", () => {
                        infowindow.open({
                        anchor: marcadorEscuela,
                        map,
                        shouldFocus: false,
                        });

                        infowindow.addListener('domready', () => {
                            if(document.getElementById(`modificar-lote-button-${codigoEscuela}`))
                            document.getElementById(`modificar-lote-button-${codigoEscuela}`).addEventListener('click', () => {
                                let valorLote = prompt("Escriba el número de lote", escuelas[codigoEscuela].lote)


                                if(Number.isInteger(parseInt(valorLote))){
                                    infowindow.close();

                                    if(ws.readyState === WebSocket.OPEN){
                                        

                                        let res = {
                                            "accion": 'modificar-lote-escuela',
                                            "entidad": 'escuela',
                                            "codigo": codigoEscuela,
                                            "nuevoValorLote": valorLote
                                        } 

                                        

                                        ws.send(JSON.stringify(res))
                                    }

                                    
                                } else {
                                    lanzarMensajeError('El valor introducido no fue un numero')


                                }

                            });
                        });

                        

                        if(modo == "calculo-de-ruta-e-indicadores"){
                            switch (funcionModo) {
                                case 'seleccionar-origen':
                                    seleccionarOrigen(codigoEscuela, marcadorEscuela, infowindow)
                                    break;

                                case 'seleccionar-paradas':
                                    seleccionarParadas(codigoEscuela, marcadorEscuela, infowindow)
                                    break;
                                
                                case 'seleccionar-destino':
                                    seleccionarDestino(codigoEscuela, marcadorEscuela, infowindow)
                                    break;
                            
                                default:
                                    break;
                            }
                        }
                    });

                    let marcadorEscuelaObj = {
                        id: codigoEscuela,//codigo
                        marcador: marcadorEscuela,
                        infoWindow: infowindow 
                    }

                    escuelas[codigoEscuela].marcadorObj = marcadorEscuelaObj

                    // marcadoresEscuelas.push(marcadorEscuelaObj)

                }

                document.getElementById('loader').classList.remove('d-flex');
                document.getElementById('loader').classList.add('d-none');
            }

            function cargarOferentes(cedulasRncOferentes, oferentes){

                document.getElementById('loader').classList.add('d-flex');

                for(let cedulaRncOferente of cedulasRncOferentes){

                    let icono; // para cambiar color segun condicion especial
                    if(oferentes[cedulaRncOferente].condicion_especial != 'NINGUNA' || oferentes[cedulaRncOferente].condicion_especial == '' || oferentes[cedulaRncOferente].condicion_especial == undefined){
                        icono = "{% static './imagenes/marcador-oferente.svg' %}"

                    } else {
                        
                        icono = {
                            path: "M19,2A13.991,13.991,0,0,0,5,16C5,26.5,19,42,19,42S33,26.5,33,16A13.991,13.991,0,0,0,19,2Z",
                            fillColor: oferentes[cedulaRncOferente].color_relleno_marcador,
                            fillOpacity: 1,
                            strokeWeight: 1,
                            strokeColor: escuelas[codigoEscuela].color_borde_marcador,
                            rotation: 0,
                            anchor: new google.maps.Point(28, 40) //se asigna ancho y largo respectivamente del svg, esto es porque el marcador escala de manera diferente cuando asignamos un string de svg

                            }
                    }

                    let marcadorOferente = new google.maps.Marker({
                        position: {
                        lat: Number(oferentes[cedulaRncOferente].latitud),
                        lng: Number(oferentes[cedulaRncOferente].longitud) 
                        },
                        map,
                        icon: icono,
                        title: cedulaRncOferente,
                        limit: 1,
                        clickable: true,
                        optimized: true,
                        // animation: null,      

                    });
                    

                    let contentString =
                        `
                        <div class="card text-white bg-primary" style="width: 18rem;">
                            <div class="card-header fs-6">
                                ${cedulaRncOferente} - <strong>${oferentes[cedulaRncOferente].nombre}</strong>
                            </div>
                            <ul class="list-group list-group-flush">
                                
                                <li class="list-group-item fs-6"><strong>Provincia: </strong>${oferentes[cedulaRncOferente].provincia}</li>
                                <li class="list-group-item fs-6"><strong>Municipio: </strong>${oferentes[cedulaRncOferente].municipio}</li>
                                <li class="list-group-item fs-6"><strong>Regional: </strong>${oferentes[cedulaRncOferente].regional}</li>
                                <li class="list-group-item fs-6"><strong>Distrito: </strong>${oferentes[cedulaRncOferente].distrito}</li>
                                <li class="list-group-item fs-6"><strong>Dirección: </strong>${oferentes[cedulaRncOferente].direccion}</li>
                                <li class="list-group-item fs-6"><strong>Latitud: </strong>${oferentes[cedulaRncOferente].latitud}</li>
                                <li class="list-group-item fs-6"><strong>Longitud: </strong>${oferentes[cedulaRncOferente].longitud}</li>
                                <li class="list-group-item fs-6"><strong>Tipo Persona: </strong>${oferentes[cedulaRncOferente].tipo_persona}</li>
                                <li class="list-group-item list-group-item-warning fs-6"><strong>Lote asignado: </strong>${oferentes[cedulaRncOferente].lote_asignado}</li>
                                <li class="list-group-item list-group-item-primary fs-6"><strong>Tiempo a escuelas: </strong>${oferentes[cedulaRncOferente].tiempo_total_a_escuelas}</li>
                                <li class="list-group-item list-group-item-primary fs-6"><strong>Distancia a escuelas: </strong>${oferentes[cedulaRncOferente].distancia_total_a_escuelas}</li>
                                <li class="list-group-item list-group-item-primary fs-6"><strong>Condicion Especial: </strong>${oferentes[cedulaRncOferente].condicion_especial}</li>
                                
                                
                            </ul>

                            <button id="calcular-ruta-oferente-button-${cedulaRncOferente}" class="btn btn-secondary" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">Calcular ruta del lote</button>
                            <a href="${host}/oferente/${cedulaRncOferente}" class="btn btn-warning" target="_blank" rel="noopener noreferrer">Administrar</a>
                        </div>
                        `;

                    //<button id="modificar-lote-button-${cedulaRncOferente}" type="button" class="ms-1 me-1 btn btn-primary btn-sm">Modificar</button>

                    
                    let infowindow = new google.maps.InfoWindow({
                        content: contentString,
                    });

                    infowindow.addListener('domready', () => {


                            $(`#calcular-ruta-oferente-button-${cedulaRncOferente}`).on('click', () => {

                                if(oferentes[cedulaRncOferente].lote_asignado != null){

                                    modoAnterior = 'visualizacion';
                                    modo = 'calculo-de-ruta-e-indicadores'
                                    paradasTabFilter.classList.remove('active');
                                    paradasTabFilter.setAttribute('aria-selected', 'false');
                                    destinoTabFilter.classList.remove('active');
                                    destinoTabFilter.setAttribute('aria-selected', 'false');
                                    origenTabFilter.classList.remove('active');
                                    origenTabFilter.setAttribute('aria-selected', 'false');
                                    
                                    funcionModo = 'seleccionar-origen';
                                    seleccionarOrigen(cedulaRncOferente, marcadorOferente, infowindow);

                                    funcionModo = 'seleccionar-paradas';
                                    for(let codigoEscuela of codigosEscuelas){
                                        if(escuelas[codigoEscuela].lote == oferentes[cedulaRncOferente].lote_asignado){
                                            seleccionarParadas(codigoEscuela, escuelas[codigoEscuela].marcadorObj.marcador, escuelas[codigoEscuela].marcadorObj.infoWindow)
                                        }
                                    
                                    }
                                    
                                    funcionModo = 'seleccionar-destino';
                                    seleccionarDestino(cedulaRncOferente, marcadorOferente, infowindow)

                                    calcularRuta(origen, paradas, destino, 1);

                                    modo = 'visualizacion';
                                    funcionModo = '';

                                } else {
                                    lanzarMensajeError("El oferente no tiene un lote asignado");
                                }

                            });
                        });

                    marcadorOferente.addListener("click", () => {
                        infowindow.open({
                        anchor: marcadorOferente,
                        map,
                        shouldFocus: false,
                        });

                        if(modo = "calculo-de-ruta-e-indicadores"){
                            switch (funcionModo) {
                                case 'seleccionar-origen':
                                    seleccionarOrigen(cedulaRncOferente, marcadorOferente, infowindow);
                                    break;
                                
                                case 'seleccionar-paradas':
                                    seleccionarParadas(cedulaRncOferente, marcadorOferente, infowindow)
                                    break;

                                case 'seleccionar-destino':
                                    seleccionarDestino(cedulaRncOferente, marcadorOferente, infowindow)
                                    break;
                            
                                default:
                                    break;
                            }
                        }
                    });

                    let marcadorOferenteObj = { //objeto con propiedades relacionadas al marcador
                        id: cedulaRncOferente,//cedula o rnc
                        marcador: marcadorOferente,
                        infoWindow: infowindow 
                    }

                    oferentes[cedulaRncOferente].marcadorObj = marcadorOferenteObj

                    // marcadoresOferentes.push(marcadorOferenteObj)

                }

                document.getElementById('loader').classList.remove('d-flex');
                document.getElementById('loader').classList.add('d-none');

            }

            document.getElementById('buscador-marcador').addEventListener('submit', e => {
                e.preventDefault();
                buscarMarcador()
            });
            
            function buscarMarcador(){
                let valorABuscar = document.getElementById('valor-a-buscar').value
                let escuelas = document.getElementById('escuelas-radio-button').checked

                if(escuelas){
                    buscarEscuela(valorABuscar)
                } else { //quiere decir que el radio button de oferentes es el que esta elegido
                    buscarOferente(valorABuscar)
                }
            }

            const toastBody = document.getElementById('toast-text-value')

            function buscarEscuela(codigo){
                for(let codigoEscuela of codigosEscuelas){
                    if(codigo == codigoEscuela){
                        map.setCenter({lat: escuelas[codigo].latitud, lng: escuelas[codigo].longitud});
                        map.setZoom(16);
                        escuelas[codigo].marcadorObj.infoWindow.open({
                        anchor: escuelas[codigo].marcadorObj.marcador,
                        map,
                        shouldFocus: false,
                        });
                        return;
                    }

                }
                
                //si no encuentra la escuela lanza este toast de error
                lanzarMensajeError('La escuela buscada no existe');

            }




            function buscarOferente(cedulaRnc){
                for(let cedulaRncOferente of cedulasRncOferentes){
                    if(cedulaRnc == cedulaRncOferente){
                        map.setCenter({lat: oferentes[cedulaRnc].latitud, lng: oferentes[cedulaRnc].longitud});
                        map.setZoom(16);
                        oferentes[cedulaRnc].marcadorObj.infoWindow.open({
                        anchor: oferentes[cedulaRnc].marcadorObj.marcador,
                        map,
                        shouldFocus: false,
                        });
                        return;
                    }

                }

                //si no encuentra el oferente lanza este toast de error
                lanzarMensajeError('El oferente buscado no existe');

            }

            function lanzarMensajeError(mensaje){
                toastBody.textContent = mensaje;
                $('#error-toast').show()
                cerrarToastAutomaticamente();
            }

            
            $('#leyenda').on("click", () => {
                borrarContenidoOffcanvasBottom();
                document.getElementById('offcanvasScrollingInfoLabel').textContent = 'Leyenda'
                $('#offcanvasScrollingInfoBody').append(
                    `
                    
                    `
                )
            });

            $('#ubicaciones-repetidas').on('click', () => {
                borrarContenidoOffcanvasBottom();
                let ubicaciones = []
                document.getElementById('offcanvasScrollingInfoLabel').textContent = 'Ubicaciones Repetidas'

                for(let codigo of codigosEscuelas){
                    let ubicacion = `${escuelas[codigo].latitud}, ${escuelas[codigo].longitud}`
                    if(ubicaciones.includes(ubicacion)){
                        $('#offcanvasScrollingInfoBody').append(
                            `
                            <span class="badge bg-success fs-6 mb-2">${codigo}</span>
                            `
                        )

                    }
                    
                    ubicaciones.push(ubicacion)
                

                }
                
            });

            $('#close-offcanvas-bottom').on('click', () => {
                
                borrarContenidoOffcanvasBottom();
            });

            function borrarContenidoOffcanvasBottom(){
                while(document.getElementById('offcanvasScrollingInfoBody').firstChild){
                    document.getElementById('offcanvasScrollingInfoBody').firstChild.remove();
                }
            }

            function cerrarToastAutomaticamente(){
                
                setTimeout(() => {
                    $('.toast').hide(2000)
                }, 10000);
            }

            $('.close-toast-button').on('click', () => { // para cerrar los toast al hacer click en la x 
                $('.toast').hide(1000);
            });

            // Para cambiar de modo visualizacion a ejecucion y viceversa en la interfaz
            $('#modo-ejecucion a').on('click', () => {
                $('#modo-visualizacion .active').removeClass('active');
                $('#modo-ejecucion a').addClass('active')
                modo = 'ejecucion'
            });

            $('#modo-visualizacion a').on('click', () => {
                $('#modo-ejecucion .active').removeClass('active');
                $('#modo-visualizacion a').addClass('active')
                modo = 'visualizacion'

            });

            // filtros

            const escuelasCheck = document.getElementById('escuelas-check')
            const oferentesCheck = document.getElementById('oferentes-check')
            const escuelasTab = document.getElementById('escuelas-tab-content')
            const oferentesTab = document.getElementById('oferentes-tab-content')


            const regionalEscuela = document.getElementById('regional-escuela')
            const distritoEscuela = document.getElementById('distrito-escuela')
            const provinciaEscuela = document.getElementById('provincia-escuela')
            const municipioEscuela = document.getElementById('municipio-escuela')
            const loteEscuela = document.getElementById('lote-escuela')
            const mayorARaciones = document.getElementById('mayor-a-raciones')
            const menorARaciones = document.getElementById('menor-a-raciones')

            const regionalOferente = document.getElementById('regional-oferente')
            const distritoOferente = document.getElementById('distrito-oferente')
            const provinciaOferente = document.getElementById('provincia-oferente')
            const municipioOferente = document.getElementById('municipio-oferente')
            const loteOferente = document.getElementById('lote-oferente')
            const mayorADistancia = document.getElementById('mayor-a-distancia')
            const menorADistancia = document.getElementById('menor-a-distancia')
            const mayorATiempo = document.getElementById('mayor-a-tiempo')
            const menorATiempo = document.getElementById('menor-a-tiempo')

            //mostrar u ocultar escuelas u oferentes
            escuelasCheck.addEventListener('input', e => {
                if(e.target.checked == false){
                    escuelasTab.classList.add('d-none')
                } else {
                    escuelasTab.classList.remove('d-none')
                }
            });

            oferentesCheck.addEventListener('input', e => {
                if(e.target.checked == false){
                    oferentesTab.classList.add('d-none')
                } else {
                    oferentesTab.classList.remove('d-none')
                }
            });

            $('#rellenar-campos-filtro-oferentes-button').on('click', rellenarFiltroOferentes);

            $('#aplicar-filtros-button').on('click', aplicarFiltros);

            function rellenarFiltroOferentes(){
                regionalOferente.value = regionalEscuela.value;
                distritoOferente.value = distritoEscuela.value;
                provinciaOferente.value = provinciaEscuela.value;
                municipioOferente.value = municipioEscuela.value;
                loteOferente.value = loteEscuela.value;
                
            }


            //el siguiente codigo es para evitar que elijan distritos que no pertenecen a la regional selecccionada y municipios que no pertenen a la provincia
            regionalEscuela.addEventListener('input', () => {
                distritoEscuela.value = '';
                provinciaEscuela.value = '';
                municipioEscuela.value = '';
                
            });

            distritoEscuela.addEventListener('input', () => {
                regionalEscuela.value = '';
                provinciaEscuela.value = '';
                municipioEscuela.value = '';
                
            });

            provinciaEscuela.addEventListener('input', () => {
                municipioEscuela.value = '';
                regionalEscuela.value = '';
                distritoEscuela.value = '';
                
            });

            municipioEscuela.addEventListener('input', () => {
                regionalEscuela.value = '';
                distritoEscuela.value = '';
                provinciaEscuela.value = '';
                
            });

            /*
            loteEscuela.addEventListener('input', () => {
                if(loteEscuela.value != ''){
                    regionalEscuela.value = '';
                    distritoEscuela.value = '';
                    provinciaEscuela.value = '';
                    municipioEscuela.value = '';

                }
                
            });*/

            regionalOferente.addEventListener('input', () => {
                municipioOferente.value = '';
                distritoOferente.value = '';
                provinciaOferente.value = '';
                
            });

            distritoOferente.addEventListener('input', () => {
                municipioOferente.value = '';
                regionalOferente.value = '';
                provinciaOferente.value = '';
                
            });

            provinciaOferente.addEventListener('input', () => {
                municipioOferente.value = '';
                regionalOferente.value = '';
                distritoOferente.value = '';
                
            });

            municipioOferente.addEventListener('input', () => {
                regionalOferente.value = '';
                distritoOferente.value = '';
                provinciaOferente.value = '';
                
            });
            
            /*
            loteOferente.addEventListener('input', () => {
                if(loteOferente.value != ''){
                    regionalOferente.value = '';
                    distritoOferente.value = '';
                    provinciaOferente.value = '';
                    municipioOferente.value = '';

                }
                
            });*/

            

            let camposFiltroEscuelas = [
                    regionalEscuela,
                    distritoEscuela,
                    provinciaEscuela,
                    municipioEscuela,
                    loteEscuela,
                    

            ]

            let camposFiltroOferentes = [
                regionalOferente,
                distritoOferente,
                provinciaOferente,
                municipioOferente,
                loteOferente, 
                mayorADistancia,
                menorADistancia,
                mayorATiempo,
                menorATiempo,

            ]

            const infoToast = document.getElementById('info-toast-text-value') //toast de informacion

            function aplicarFiltros(){

                let mostrarTodasLasEscuelas = true; //mostrar todas las escuelas por default
                let mostrarTodosLosOferentes = true; // todos los oferentes por default
                let cantidadEscuelas = 0; //Cantidad de oferentes encontrados al hacer filtro
                let cantidadOferentes = 0; //Cantidad de oferentes encontrados al hacer filtro
                let totalRaciones = 0;

                for(let campo of camposFiltroEscuelas){ // todos los campos deben estar null para poder mostrar todas las escuelas, excepto el de las raciones por si queremos filtrar solo por raciones
                    if(campo.value != ''){
                        mostrarTodasLasEscuelas = false;
                        break
                    } 
                }

                for(let campo of camposFiltroOferentes){ // todos los campos deben estar null para poder mostrar todos los oferentes
                    if(campo.value != ''){
                        mostrarTodosLosOferentes = false;
                        break
                    } 
                }

                for(let codigoEscuela of codigosEscuelas){

                    escuelas[codigoEscuela].marcadorObj.marcador.setLabel(null)

                    if(escuelasCheck.checked == false){
                        escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false)
                    }else if(mostrarTodasLasEscuelas){

                        //filtrar por raciones respecto a todas las escuelas
                        if(mayorARaciones.value != '' && menorARaciones.value != ''){ //si los valores no estan vacios para ambos campos
                            if(escuelas[codigoEscuela].cantidad_matriculados >= mayorARaciones.value && escuelas[codigoEscuela].cantidad_matriculados <= menorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }

                        } else if(mayorARaciones.value == '' && menorARaciones.value != '') {
                            if(escuelas[codigoEscuela].cantidad_matriculados <= menorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }

                        } else if(menorARaciones.value == '' && mayorARaciones.value != '') {
                            if(escuelas[codigoEscuela].cantidad_matriculados >= mayorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }
                        } else {
                            escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                            cantidadEscuelas++;
                            totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                        }
                    }else if((escuelas[codigoEscuela].regional == regionalEscuela.value ||
                             escuelas[codigoEscuela].distrito == distritoEscuela.value ||
                             escuelas[codigoEscuela].provincia == provinciaEscuela.value ||
                             escuelas[codigoEscuela].municipio == municipioEscuela.value) &&
                             loteEscuela.value == '') {


                        
                        if(mayorARaciones.value != '' && menorARaciones.value != ''){ //si los valores no estan vacios para ambos campos
                            if(escuelas[codigoEscuela].cantidad_matriculados >= mayorARaciones.value && escuelas[codigoEscuela].cantidad_matriculados <= menorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                                // escuelas[codigoEscuela].marcadorObj.marcador.setIcon({url: "{% static './marcador-escuela.svg' %}", labelOrigin: google.maps.Point(-5, -5)})
                                escuelas[codigoEscuela].marcadorObj.marcador.setLabel({text: `L${escuelas[codigoEscuela].lote}`, color: 'white', fontSize: '15px'})
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }
                            

                        } else if(mayorARaciones.value == '' && menorARaciones.value != '') {
                            if(escuelas[codigoEscuela].cantidad_matriculados <= menorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                                // escuelas[codigoEscuela].marcadorObj.marcador.setIcon({url: "{% static './marcador-escuela.svg' %}", labelOrigin: google.maps.Point(-5, -5)})
                                escuelas[codigoEscuela].marcadorObj.marcador.setLabel({text: `L${escuelas[codigoEscuela].lote}`, color: 'white', fontSize: '15px'})
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }

                        } else if(menorARaciones.value == '' && mayorARaciones.value != '') {
                            if(escuelas[codigoEscuela].cantidad_matriculados >= mayorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                                // escuelas[codigoEscuela].marcadorObj.marcador.setIcon({url: "{% static './marcador-escuela.svg' %}", labelOrigin: google.maps.Point(-5, -5)})
                                escuelas[codigoEscuela].marcadorObj.marcador.setLabel({text: `L${escuelas[codigoEscuela].lote}`, color: 'white', fontSize: '15px'})
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }
                        } else { //los dos campos de raciones estan vacios
                            escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                            cantidadEscuelas++;
                            totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                            // escuelas[codigoEscuela].marcadorObj.marcador.setIcon({url: "{% static './marcador-escuela.svg' %}", labelOrigin: google.maps.Point(-5, -5)})
                            escuelas[codigoEscuela].marcadorObj.marcador.setLabel({text: `L${escuelas[codigoEscuela].lote}`, color: 'white', fontSize: '15px'})
                        }
                        
                    } else if((regionalEscuela.value == '' &&
                             distritoEscuela.value == '' &&
                             provinciaEscuela.value == '' &&
                             municipioEscuela.value == '') &&
                             loteEscuela.value == escuelas[codigoEscuela].lote){ //solo esta elegido el campo lote y racione en este caso
                        
                        if(mayorARaciones.value != '' && menorARaciones.value != ''){ //si los valores no estan vacios para ambos campos
                        if(escuelas[codigoEscuela].cantidad_matriculados >= mayorARaciones.value && escuelas[codigoEscuela].cantidad_matriculados <= menorARaciones.value){
                            escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                            cantidadEscuelas++;
                            totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                        } else {
                            escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                        }
                            

                        } else if(mayorARaciones.value == '' && menorARaciones.value != '') {
                            if(escuelas[codigoEscuela].cantidad_matriculados <= menorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }

                        } else if(menorARaciones.value == '' && mayorARaciones.value != '') {
                            if(escuelas[codigoEscuela].cantidad_matriculados >= mayorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }
                        } else { //los dos campos de raciones estan vacios
                            escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                            cantidadEscuelas++;
                            totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                        }

                    
                    }else if((escuelas[codigoEscuela].regional == regionalEscuela.value ||
                             escuelas[codigoEscuela].distrito == distritoEscuela.value ||
                             escuelas[codigoEscuela].provincia == provinciaEscuela.value ||
                             escuelas[codigoEscuela].municipio == municipioEscuela.value) &&
                             loteEscuela.value == escuelas[codigoEscuela].lote){ // por lote y raciones a partir de aqui
                        
                        if(mayorARaciones.value != '' && menorARaciones.value != ''){ //si los valores no estan vacios para ambos campos
                        if(escuelas[codigoEscuela].cantidad_matriculados >= mayorARaciones.value && escuelas[codigoEscuela].cantidad_matriculados <= menorARaciones.value){
                            escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                            cantidadEscuelas++;
                            totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                        } else {
                            escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                        }
                            

                        } else if(mayorARaciones.value == '' && menorARaciones.value != '') {
                            if(escuelas[codigoEscuela].cantidad_matriculados <= menorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }

                        } else if(menorARaciones.value == '' && mayorARaciones.value != '') {
                            if(escuelas[codigoEscuela].cantidad_matriculados >= mayorARaciones.value){
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                                cantidadEscuelas++;
                                totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                            } else {
                                escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                            }
                        } else { //los dos campos de raciones estan vacios
                            escuelas[codigoEscuela].marcadorObj.marcador.setVisible(true);
                            cantidadEscuelas++;
                            totalRaciones += escuelas[codigoEscuela].cantidad_matriculados;
                        }
                    
                    }else {

                        escuelas[codigoEscuela].marcadorObj.marcador.setVisible(false);
                             
                    }

                }
                
                for(let cedulaRncOferente of cedulasRncOferentes){
                    if(oferentesCheck.checked == false){
                        oferentes[cedulaRncOferente].marcadorObj.marcador.setVisible(false)
                    }else if(mostrarTodosLosOferentes){

                        //filtrar por raciones respecto a todas las escuelas
                        // if(mayorARaciones.value != '' && menorARaciones.value != ''){ //si los valores no estan vacios para ambos campos
                        //     if(escuelas[cedulaRncOferente].cantidad_matriculados >= mayorARaciones.value && escuelas[cedulaRncOferente].cantidad_matriculados <= menorARaciones.value){
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        //     } else {
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(false);
                        //     }

                        // } else if(mayorARaciones.value == '' && menorARaciones.value != '') {
                        //     if(escuelas[cedulaRncOferente].cantidad_matriculados <= menorARaciones.value){
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        //     } else {
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(false);
                        //     }

                        // } else if(menorARaciones.value == '' && mayorARaciones.value != '') {
                        //     if(escuelas[cedulaRncOferente].cantidad_matriculados >= mayorARaciones.value){
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        //     } else {
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(false);
                        //     }
                        // } else {
                        //     escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        // }

                        oferentes[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        cantidadOferentes++;

                    }else if(oferentes[cedulaRncOferente].regional == regionalOferente.value ||
                             oferentes[cedulaRncOferente].distrito == distritoOferente.value ||
                             oferentes[cedulaRncOferente].provincia == provinciaOferente.value ||
                             oferentes[cedulaRncOferente].municipio == municipioOferente.value ||
                             oferentes[cedulaRncOferente].lote == loteOferente.value) {

                        
                        // if(mayorARaciones.value != '' && menorARaciones.value != ''){ //si los valores no estan vacios para ambos campos
                        //     if(escuelas[cedulaRncOferente].cantidad_matriculados >= mayorARaciones.value && escuelas[cedulaRncOferente].cantidad_matriculados <= menorARaciones.value){
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        //     } else {
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(false);
                        //     }
                            

                        // } else if(mayorARaciones.value == '' && menorARaciones.value != '') {
                        //     if(escuelas[cedulaRncOferente].cantidad_matriculados <= menorARaciones.value){
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        //     } else {
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(false);
                        //     }

                        // } else if(menorARaciones.value == '' && mayorARaciones.value != '') {
                        //     if(escuelas[cedulaRncOferente].cantidad_matriculados >= mayorARaciones.value){
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        //     } else {
                        //         escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(false);
                        //     }
                        // } else { //los dos campos de raciones estan vacios
                        //     escuelas[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        // }
                        oferentes[cedulaRncOferente].marcadorObj.marcador.setVisible(true);
                        cantidadOferentes++;
                        
                    } else {

                        
                        oferentes[cedulaRncOferente].marcadorObj.marcador.setVisible(false);
                        
                        
                        
                    }

                }

                map.setCenter(origin);
                map.setZoom(8)

                infoToast.textContent = `Cantidad de ESCUELAS: ${cantidadEscuelas}, Total de RACIONES: ${totalRaciones}, Cantidad de OFERENTES: ${cantidadOferentes}`
                $('#info-toast').show()
                // cerrarToastAutomaticamente();
            }

            /* ------------------------------- Codigo relacionado a la rutas y sus calculos -------------------------------------------

            */

            const origenTabFilter = document.getElementById('origen-tab-filter');
            const paradasTabFilter = document.getElementById('paradas-tab-filter');
            const destinoTabFilter = document.getElementById('destino-tab-filter');

            $('#calcular-ruta-e-indicadores').on('click', () => {
                modoAnterior = modo;
                modo = 'calculo-de-ruta-e-indicadores'
  
                paradasTabFilter.classList.remove('active');
                paradasTabFilter.setAttribute('aria-selected', 'false');
                destinoTabFilter.classList.remove('active');
                destinoTabFilter.setAttribute('aria-selected', 'false');
                origenTabFilter.classList.remove('active');
                origenTabFilter.setAttribute('aria-selected', 'false');

                

            });
            $('#close-offcanvas').on('click', () => {
                
                cerrarCalculoDeRutaEIndicadores();
                modo = 'visualizacion'; //volver al modo anterior antes de elegir la herramienta
                funcionModo = ''

            })

            $('#origen-tab-filter').on('click', () => {funcionModo = 'seleccionar-origen'});
            $('#paradas-tab-filter').on('click', () => {funcionModo = 'seleccionar-paradas'});
            $('#destino-tab-filter').on('click', () => {funcionModo = 'seleccionar-destino'});

            const origenTabContent =  document.getElementById('origen-tab-content');
            const paradasTabContent =  document.getElementById('paradas-tab-content');
            const destinoTabContent =  document.getElementById('destino-tab-content');
            const detallesDelViajeElement = document.getElementById('offcanvas-detalles-del-viaje');

            let origen; //objeto de posicion del origen
            let origenDOM; // un objeto que contiene id, marker y el infowindow
            let paradas = []; //objetos de posiciones
            let paradasId = []; //para poder comprobar cuales estan y poder borrarlas del DOM cuando se requiera
            let paradasDOM = []; //para poder quitar la animacion mas adelante es mejor guardarlos aqui
            let destino;
            let destinoDOM;

            function seleccionarOrigen(id, marker, infowindow){

                if(document.getElementById(`origen-${id}`)){
                    $(`#origen-tab-content #origen-${id}`).remove();
                    origen = null; //borrar seleccion
                    marker.setAnimation(null);
                    infowindow.close();

                } else {

                    if(origenDOM){ // para evitar que se agreguen mas de un origen

                            $(`#origen-tab-content #origen-${origenDOM.id}`).remove();
                            origenDOM.marker.setAnimation(null);
                            origenDOM.infowindow.close();

                    }

                    let colorBadge;

                    if(id.length == 5){colorBadge = 'success'} else {colorBadge = 'primary'} //elegir color diferente para marcador y para escuelas

                    let nuevoElemento = `<span id="origen-${id}" class="fs-6 badge rounded-pill bg-${colorBadge}">${id}<button id="close-button-origen-${id}" type="button" class="btn-close" aria-label="Close"></button></span>`
                    $('#origen-tab-content').append(nuevoElemento)

                    origen = marker.position
                    marker.setAnimation(google.maps.Animation.BOUNCE); //hacer que salte el marcador para visualizarlo mejor
                    origenDOM = {
                        id: id,
                        marker: marker,
                        infowindow: infowindow
                    }


                    $(`#close-button-origen-${id}`).on('click', () => { //borrar seleccion
                        $(`#origen-tab-content #origen-${id}`).remove();
                        origen = null;
                        marker.setAnimation(null);
                        infowindow.close();
                    });
                    
                }

                
            }

            function seleccionarParadas(id, marker, infowindow) {
                if(origen == null || origenDOM == null){
                    lanzarMensajeError('Debe elegir el origen primero');
                    

                } else {

                    if(document.querySelector(`#paradas-tab-content #parada-${id}`)){ // para evitar que se agregue la misma parada

                        $(`#paradas-tab-content #parada-${id}`).remove();
                        paradas.splice(paradas.indexOf(paradasId.indexOf(id)), 1); //el numero del indice de ambos array es el mismo
                        paradasId.splice(paradasId.indexOf(id), 1);
                        marker.setAnimation(null);
                        infowindow.close();


                    }

                    let colorBadge;

                    if(id.length == 5){colorBadge = 'success'} else {colorBadge = 'primary'} //elegir color diferente para marcador y para escuelas

                    let nuevoElemento = `<span id="parada-${id}" class="fs-6 badge rounded-pill bg-${colorBadge}">${id}<button id="close-button-parada-${id}" type="button" class="btn-close" aria-label="Close"></button></span>`
                    $('#paradas-tab-content').append(nuevoElemento)

                    waypoint = {
                        location: marker.position,
                        stopover: true
                    }
                    paradas.push(waypoint)
                    paradasId.push(id)
                    paradasDOM.push({
                        marker: marker,
                        infowindow: infowindow
                    })
                    marker.setAnimation(google.maps.Animation.BOUNCE); //hacer que salte el marcador para visualizarlo mejor

                    $(`#close-button-parada-${id}`).on('click', () => { //borrar seleccion
                        $(`#paradas-tab-content #parada-${id}`).remove();
                        paradas.splice(paradas.indexOf(paradasId.indexOf(id)), 1); 
                        paradasId.splice(paradas.indexOf(id), 1);
                        marker.setAnimation(null);
                        infowindow.close();
                    });
                }
            }

            function seleccionarDestino(id, marker, infowindow){ // es el mismo codigo que la funcion seleccionarOrigen pero cambiando la palabra origen por destino

                if(origen == null || origenDOM == null){
                    lanzarMensajeError('Debe elegir el origen primero');
                    
                } else if(document.getElementById(`destino-${id}`)){
                    $(`#destino-tab-content #destino-${id}`).remove();
                    destino = null; //borrar seleccion
                    marker.setAnimation(null);
                    infowindow.close();

                } else {

                    if(destinoDOM){ // para evitar que se agreguen mas de un destino

                        $(`#destino-tab-content #destino-${destinoDOM.id}`).remove();
                        destinoDOM.marker.setAnimation(null);
                        destinoDOM.infowindow.close();

                    }

                    let colorBadge;

                    if(id.length == 5){colorBadge = 'success'} else {colorBadge = 'primary'} //elegir color diferente para marcador y para escuelas

                    let nuevoElemento = `<span id="destino-${id}" class="fs-6 badge rounded-pill bg-${colorBadge}">${id}<button id="close-button-destino-${id}" type="button" class="btn-close" aria-label="Close"></button></span>`
                    $('#destino-tab-content').append(nuevoElemento)

                    destino = marker.position
                    marker.setAnimation(google.maps.Animation.BOUNCE); //hacer que salte el marcador para visualizarlo mejor
                    destinoDOM = {
                        id: id,
                        marker: marker,
                        infowindow: infowindow
                    }

                    $(`#close-button-destino-${id}`).on('click', () => { //borrar seleccion
                        $(`#destino-tab-content #destino-${id}`).remove();
                        destino = null;
                        marker.setAnimation(null);
                        infowindow.close();
                    });
                    
                }

                
            }

            const recuentoDistancia = document.querySelector('#recuento-distancia strong');
            const recuentoTiempo = document.querySelector('#recuento-tiempo strong');
            const recuentoRaciones = document.querySelector('#recuento-raciones strong');

            function cerrarCalculoDeRutaEIndicadores(){


                if(origenDOM != null){
                    origenDOM.marker.setAnimation(null);
                    origenDOM.infowindow.close();
                }

                if(destinoDOM != null){
                    destinoDOM.marker.setAnimation(null);
                    destinoDOM.infowindow.close();
                }
                

                if(paradasDOM.length > 0)
                for(let parada of paradasDOM){
                    parada.marker.setAnimation(null);
                    parada.infowindow.close();
                }


                origen = null;
                origenDOM = null;
                paradas = [];
                destino = null;
                destinoDOM = null;
                
                while(origenTabContent.hasChildNodes()){
                    origenTabContent.firstChild.remove(); //borrar pill del origen en la interfaz
                }
                
                
                while(paradasTabContent.hasChildNodes()){
                    paradasTabContent.firstChild.remove();
                }

                while(destinoTabContent.hasChildNodes()){
                    destinoTabContent.firstChild.remove();
                }
                 
                
                while(detallesDelViajeElement.hasChildNodes()){
                    detallesDelViajeElement.firstChild.remove();
                }
                

                directionsRenderer.setMap(null) //borrar ruta trazada anteriormente del mapa

                recuentoDistancia.textContent = '';
                recuentoTiempo.textContent = '';
                recuentoRaciones.textContent = '';

                 
            }

            $('#offcanvas-calcular-ruta-button').on('click', () => {
                calcularRuta(origen, paradas, destino, 0);
            });
            

            function calcularRuta(origin, waypoints, end, numeroRestaLegs) { //origin y end: un objeto que contiene lat y lng como propiedades. waypoints: un array con objetos con propiedad location y stopover igual a true

                if(origen == null || destino == null){
                    lanzarMensajeError('Debe elegir al menos un origen y un destino');
                    return
                }
                while(detallesDelViajeElement.hasChildNodes()){
                    detallesDelViajeElement.firstChild.remove();
                }

                let distanciaTotalViaje = 0.0;
                let tiempoTotalViaje = 0.0;


                directionsRenderer.setMap(null) //borrar trazo de ruta trazada anteriormente del mapa


                directionsService.route({
                    origin: origin,
                    destination: end,
                    waypoints: waypoints,
                    optimizeWaypoints: true,
                    travelMode: google.maps.TravelMode.DRIVING,
                    drivingOptions: {
                        departureTime: new Date(),
                        trafficModel: google.maps.TrafficModel.BEST_GUESS
                    },
                    provideRouteAlternatives: true,
                    unitSystem: google.maps.UnitSystem.METRIC
                }, (response, status)  => {
                    if (status === google.maps.DirectionsStatus.OK) {

                        let route = response.routes[0];

                        directionsRenderer.setDirections(response);

                        directionsRenderer.setMap(map)

                    // For each route, display summary information.
                    for (let i = 0; i < route.legs.length - numeroRestaLegs; i++) {

                        let distancia = parseFloat(route.legs[i].distance.value / 1000.0).toFixed(2);
                        let tiempo = parseFloat(route.legs[i].duration.value / 60.0).toFixed(2);

                        if(route.legs[i].distance)
                        distanciaTotalViaje += parseFloat(route.legs[i].distance.value / 1000.0);

                        if(route.legs[i].duration)
                        tiempoTotalViaje += parseFloat(route.legs[i].duration.value / 60.0);
                        

                        $('#offcanvas-detalles-del-viaje').append(
                            `<div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Origen: ${route.legs[i].start_address}</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">Destino: ${route.legs[i].end_address}</h6>
                                    <ul class="list-group">
                                        <li class="list-group-item">Distancia: ${distancia} km</li>
                                        <li class="list-group-item">Tiempo: ${tiempo} min</li>
                                    </ul>

                                </div>
                            </div>`
                        )

                        

                    }  
                    
                    distanciaTotalViaje = distanciaTotalViaje.toFixed(2);
                    tiempoTotalViaje = tiempoTotalViaje.toFixed(2);
                    recuentoDistancia.textContent = distanciaTotalViaje;
                    recuentoTiempo.textContent = tiempoTotalViaje;
                    

                    let totalRaciones = 0;

                    if(origenDOM.marker.title.length == 5){
                        totalRaciones += escuelas[origenDOM.marker.title].cantidad_matriculados
                    }
                    if(destinoDOM.marker.title.length == 5){
                        totalRaciones += escuelas[destinoDOM.marker.title].cantidad_matriculados
                    }

                    for(let p of paradasDOM){
                        if(p.marker.title.length == 5){
                            totalRaciones += escuelas[p.marker.title].cantidad_matriculados
                        }
                    }
                    
                    recuentoRaciones.textContent = totalRaciones;
                        
                    } else {
                        //si no se puede calcular la ruta por no ser accesible en vehiculo
                        toastBody.textContent = `Hubo un error calculando la ruta, los vehiculos no pueden llegar a al menos una de las escuelas seleccionadas. Detalle: ${status}`
                        $('#error-toast').show()
                        cerrarToastAutomaticamente();
                    }
                });
            }


            





        </script>
    </body>
</html>