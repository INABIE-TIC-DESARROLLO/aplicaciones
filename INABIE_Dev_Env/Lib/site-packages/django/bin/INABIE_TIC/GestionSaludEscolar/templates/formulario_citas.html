<!DOCTYPE html>
<html lang="en">
    <head>
        {% load static %}
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>INABIE - Salud - Citas</title>
        <link rel="icon" href="{% static 'imagenes/logo.jpg' %}">
        <link rel="stylesheet" href="{% static '/bootstrap-5.1.3-dist/css/bootstrap.css' %}">
        
        <style>
            /* Estilos de base para todas las paginas - Inicio */

            html, body, div, span, applet, object, iframe,
            h1, h2, h3, h4, h5, h6, p, blockquote, pre,
            a, abbr, acronym, address, big, cite, code,
            del, dfn, em, img, ins, kbd, q, s, samp,
            small, strike, strong, sub, sup, tt, var,
            b, u, i, center,
            dl, dt, dd, ol, ul, li,
            fieldset, form, label, legend,
            table, caption, tbody, tfoot, thead, tr, th, td,
            article, aside, canvas, details, embed, 
            figure, figcaption, footer, header, hgroup, 
            menu, nav, output, ruby, section, summary,
            time, mark, audio, video {
                margin: 0;
                padding: 0;
                border: 0;
                font-size: 100%;
                font: inherit;
                vertical-align: baseline;
            }
            /* HTML5 display-role reset for older browsers */
            article, aside, details, figcaption, figure, 
            footer, header, hgroup, menu, nav, section {
                display: block;
            }


            body {
                line-height: 1;

            }
            ol, ul {
                list-style: none;
            }
            blockquote, q {
                quotes: none;
            }
            blockquote:before, blockquote:after,
            q:before, q:after {
                content: '';
                content: none;
            }
            table {
                border-collapse: collapse;
                border-spacing: 0;
            }

            button{
                transform: scale(1);
                transition: transform .15s linear;
                padding: .5rem;
                border: none;
                border-radius: .3rem;
            }

            button:hover{
                transform: scale(1.1);
            }

            .action-button{
                background-color: #1f3c73;
                color: aliceblue;
                
                
            }

            .encabezado{
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                margin: 3rem 2rem;
            }

            .encabezado img{
                width: 20%;
                position: relative;
                left: 0;
                animation: animacion-logo 1s linear;
            }

            .texto-encabezado{
                color: #1f3c73;
            }

            @keyframes animacion-degradado {
                from{
                    background-color: #ececec;
                }

                to{
                    background-color: white;
                }
            }

            @keyframes animacion-logo {
                from{
                    left: -500px;
                }

                to{
                    left: 0;
                }
            }

            /* Estilos de base para todas las paginas - Fin */

            h1{
                font-size: 2rem;
            }

            h2{
                font-size: 1.7rem;
            }

            .calendar-container{
                display: flex;
                justify-content: center;
                margin: 75px auto;
                width: 100%;

            }

            .side-nav-calendar{
                width: 100%;
            }


            .calendario{

                width: 100%;
                display: flex;
                
                
                
            }

            .year-month, .days, .schedule{
                
                padding: 1rem;
            }

            .year-month{

            }

            .days{
                width: 100%;
                display: flex;
                flex-wrap: wrap;
            }

            .days div{
                flex: 0 1 calc(100% / 7);

            }

            .schedule{
                display: flex;
                flex-direction: column;
                flex-wrap: wrap;
            }

            .nombre-dia {
                
                text-align: center;
                border: 1px solid #1f3c73;
                border-bottom: none;
                border-left: none;
                border-radius: .5rem;
                color: #1f3c73;
                font-size: 1.7rem;

            }

            .day{

                display: flex;
                justify-content: center;
                align-items: center;
                margin: .2rem;
                padding: 1rem;
                background-color: white;
                border: 1px solid #1f3c73;
                color: #1f3c73;
                border-radius: .5rem;
                font-size: 1.5rem;
                transition: background-color .15s linear;

            }

            .day:hover{


                background-color: #1f3c73;
                border: none;
                color: aliceblue;
                cursor: pointer;
                

            }

            .no-disponible{
                background-color: #c81025;
                color: aliceblue;
                border: none;
                cursor: not-allowed;

            }

            .no-disponible:hover{
                background-color: #c81025;
                color: aliceblue;
                border: none;
                cursor: not-allowed;

            }



            select{
                width: 100%;
                margin: .25rem auto;
                background-color: #ececec;
                color: #1f3c73;
                border-radius: .25rem;
                font-size: 1.5rem;
                margin: 0 .2rem;
            }

            h1, h2{
                color: #1f3c73;
            }

            .selects-calendar{
                display: flex;
                flex-wrap: nowrap;
            }


        </style>

    </head>
    <body>

        <div class="calendar-container">
            
            <div class="calendario">

                <div class="days">
                    
                    <div class="nombre-dia">Lunes</div>
                    <div class="nombre-dia">Martes</div>
                    <div class="nombre-dia">Miercoles</div>
                    <div class="nombre-dia">Jueves</div>
                    <div class="nombre-dia">Viernes</div>
                    <div class="nombre-dia">Sábado</div>
                    <div class="nombre-dia">Domingo</div>

                    {% for day in days_before_first_day %}

                        <div ></div>

                    {% endfor %}

                    {% for day in days_list %}
                        
                            
                            
                        {% if day.number_day_week == 0%}
                            <div class="lunes">
                                    <div class="day" id="day-{{day.number_day_calendar}}">
                                        {{day.number_day_calendar}}
                                    </div>
                            </div>

                        {% endif %}
  
                        {% if day.number_day_week == 1%}
                            <div class="martes">
                                    <div class="day" id="day-{{day.number_day_calendar}}">
                                        {{day.number_day_calendar}}
                                    </div>
                            </div>

                        {% endif %}

                        {% if day.number_day_week == 2%}
                            <div class="miercoles">
                                    <div class="day" id="day-{{day.number_day_calendar}}">
                                        {{day.number_day_calendar}}
                                    </div>
                            </div>

                        {% endif %}

                        {% if day.number_day_week == 3%}
                            <div class="jueves">
                                    <div class="day" id="day-{{day.number_day_calendar}}">
                                        {{day.number_day_calendar}}
                                    </div>
                            </div>

                        {% endif %}

                        {% if day.number_day_week == 4%}
                            <div class="viernes">
                                    <div class="day" id="day-{{day.number_day_calendar}}">
                                        {{day.number_day_calendar}}
                                    </div>
                            </div>

                        {% endif %}

                        {% if day.number_day_week == 5%}
                            <div class="sabado">
                                    <div class="day no-disponible" id="day-{{day.number_day_calendar}}">
                                        {{day.number_day_calendar}}
                                    </div>
                            </div>

                        {% endif %}

                        {% if day.number_day_week == 6%}
                            <div class="domingo">
                                    <div class="day no-disponible" id="day-{{day.number_day_calendar}}">
                                        {{day.number_day_calendar}}
                                    </div>
                            </div>

                        {% endif %}
  
                    {% endfor %}

                   
                </div>

                <div class="side-nav-calendar">
                    <div class="year-month">
                        <!-- Consultar por año y mes -->

                        
                        <form action="" method="post" id="filtros-calendario">
                            {% csrf_token %}
                            <input id="cambiar-calendario" name="accion" type="hidden" value="cambiar-calendario">
                            
                            <div class="selects-calendar">
                                <select name="year" id="year">
                                    {% if actual_year == selected_year %}
                                        <option value="{{actual_year}}" selected>{{actual_year}}</option>
                                    {% else %}
                                        <option value="{{actual_year}}">{{actual_year}}</option>
                                    {% endif %}
    
                                    {% if next_year == selected_year %}
                                        <option value="{{next_year}}" selected>{{next_year}}</option>
                                    {% else %}
                                        <option value="{{next_year}}">{{next_year}}</option>
                                    {% endif %}
                                    
                                    
                                </select>
        
                                <select name="month" id="month">
    
                                    {% if actual_month == 1 %}
                                        <option value="1" selected>Enero</option>
                                    {% else %}
                                        <option value="1">Enero</option>
                                    {% endif %}
    
                                    {% if actual_month == 2 %}
                                        <option value="2" selected>Febrero</option>
                                    {% else %}
                                        <option value="2">Febrero</option>
                                    {% endif %}
    
                                    {% if actual_month == 3 %}
                                        <option value="3" selected>Marzo</option>
                                    {% else %}
                                        <option value="3">Marzo</option>
                                    {% endif %}
    
                                    {% if actual_month == 4 %}
                                        <option value="4" selected>Abril</option>
                                    {% else %}
                                        <option value="4">Abril</option>
                                    {% endif %}
    
                                    {% if actual_month == 5 %}
                                        <option value="5" selected>Mayo</option>
                                    {% else %}
                                        <option value="5">Mayo</option>
                                    {% endif %}
    
                                    {% if actual_month == 6 %}
                                        <option value="6" selected>Junio</option>
                                    {% else %}
                                        <option value="6">Junio</option>
                                    {% endif %}
                                    
                                    {% if actual_month == 7 %}
                                        <option value="7" selected>Julio</option>
                                    {% else %}
                                        <option value="7">Julio</option>
                                    {% endif %}
    
                                    {% if actual_month == 8 %}
                                        <option value="8" selected>Agosto</option>
                                    {% else %}
                                        <option value="8">Agosto</option>
                                    {% endif %}
    
                                    {% if actual_month == 9 %}
                                        <option value="9" selected>Septiembre</option>
                                    {% else %}
                                        <option value="9">Septiembre</option>
                                    {% endif %}
    
                                    {% if actual_month == 10 %}
                                        <option value="10" selected>Octubre</option>
                                    {% else %}
                                        <option value="10">Octubre</option>
                                    {% endif %}
    
                                    {% if actual_month == 11 %}
                                        <option value="11" selected>Noviembre</option>
                                    {% else %}
                                        <option value="11">Noviembre</option>
                                    {% endif %}
    
                                    {% if actual_month == 12 %}
                                        <option value="12" selected>Diciembre</option>
                                    {% else %}
                                        <option value="12">Diciembre</option>
                                    {% endif %}
                                    
                                    
                                    
                                    
                                    
                                </select>

                            </div>
                            
                        </form>

                        <!-- <button type="submit" class="action-button">Consultar</button> -->

                    </div>
    
                    <div class="schedule">

                        <h1 class="text-center mb-3 mt-3">Horarios disponibles</h1>

                        <div class="d-grid gap-2">
                            <button type="button" class="action-button">
                                8:00 a.m. - 10:00 a.m. <span class="badge bg-danger">4</span>
                            </button>
        
                            <button type="button" class="action-button">
                                11:00 a.m. - 1:00 p.m <span class="badge bg-danger">4</span>
                            </button>
                        </div>


                        <div class="card border-success mb-3 mt-3" >
                            <div class="card-header">Resumen de cita</div>
                            <div class="card-body text-success">
                              <h1 class="card-title">Fecha elegida: <span id="fecha-elegida">xx/xx/xxxx</span></h1>
                              <h2>Horario Elegido: </h2>
                            </div>
                        </div>

                    </div>

                    

                    


                </div>
                
            </div>
        </div>

        <script src="{% static '/jquery-3.6.0.js' %}"></script>
        <script src="{% static '/popper.min.js' %}"></script>
        <script src="{% static '/bootstrap-5.1.3-dist/js/bootstrap.js' %}"></script>


        <script>

            const host = window.location.host

            const ws = new WebSocket(
              'ws://'
              + host
              + '/salud-escolar/'

            );

            ws.onopen = function (e) {
                
            
            };

            ws.onmessage = e => {
                let data = JSON.parse(e.data)

                if(data["accion"] == "cambiar-calendario"){


                }
            }


            const fechaElegida = document.getElementById('fecha-elegida')

            const year = document.getElementById('year')
            const month = document.getElementById('month')

            $(".day").on("click", e => {

                if(e.target.classList.contains("no-disponible")){
                    alert("No hay horarios disponibles para este día")
                } else {
                    let dia = e.target.textContent
                    fechaElegida.textContent = `${dia}/${month.value}/${year.value}`
                }
                
                
            });

            function sendData() {
                let jsonData = {
                    "accion": "cambiar-calendario",
                    "selected-year": year.value,
                    "selected-month": month.value
                }

                let data = JSON.stringify(jsonData)

                // fetch("citas", {
                //     method: "POST",
                //     body: data,
                //     headers: {

                //         "X-CSRFToken": '{{csrf_token}}'
                //     },
                //     credentials: 'same-origin'
                    
                // }).then(res => {
                //     console.log(res.status)
                // })

                document.getElementById("filtros-calendario").submit();

                ws.send(data)
                
            }

            
            year.addEventListener("input", () => {
                sendData();
            });

            month.addEventListener("input", () => {
                sendData();
            });

        </script>


       
        
    </body>
</html>