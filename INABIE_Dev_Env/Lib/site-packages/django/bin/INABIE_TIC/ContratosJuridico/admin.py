from django.contrib import admin
from django.contrib.admin.options import ModelAdmin
from .models import DatosContrato
from django.http import HttpResponse
from django.contrib.messages import constants as messages
import openpyxl



@admin.action(description="Descargar archivo seleccionado")
def descargarArchivos(modeladmin, request, queryset):

    if(len(queryset) > 1):
        admin.ModelAdmin.message_user(request=request, self=modeladmin, level= messages.ERROR, message="No puedes descargar mas de un archivo a la vez")
    else:
        
        archivo = open(str(queryset[0].archivo), 'rb')

        response = HttpResponse(archivo, headers= {
        'Content-Type': 'application/vnd.ms-excel',
        'Content-Disposition': 'attachment; filename="DATA-JURIDICO.xlsx"'
        })

        archivo.close()
        
        return response

    

    


class DatosContratoAdmin(admin.ModelAdmin):
    list_display = ["nombre", "fecha", "archivo"]
    actions = [descargarArchivos, ]


admin.site.register(DatosContrato, DatosContratoAdmin)
# Register your models here.
